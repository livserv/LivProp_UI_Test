"use strict";(self.webpackChunklib_prop_ui=self.webpackChunklib_prop_ui||[]).push([[5209],{93383:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(9950),l=n(10226),s=n(46639),a=n(44414);const c=function(e){let{onClick:t,disabled:n,isLoading:c,children:i,...r}=e;const[d,u]=o.useState(c);return(0,a.jsxs)(l.A,{onClick:e=>{if(!t)return;const n=t(e);"function"===typeof(null===n||void 0===n?void 0:n.finally)&&(u(!0),n.finally((()=>u(!1))))},disabled:d||c||n,...r,children:[(d||c)&&(0,a.jsx)(s.A,{size:16,color:"primary",style:{marginRight:"10px"}}),i]})}},54310:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var o=n(9950),l=n(39320),s=n(33340),a=n(8478);function c(e){return{value:e._id,label:"v".concat(e.version," - ").concat(e.deployedAt?"Deployed":"Draft")}}var i=n(32026);const r=o.createContext({}),d="start-web";const u=function(e,t){const n=(0,s.nc)((e=>e.selectedBotId)),c=(0,s.nc)((e=>e.organizationId)),[r,u]=o.useState(f(t)),p=o.useRef({flowData:r});p.current.flowId=e,p.current.flowData=r,o.useEffect((()=>{var t;e&&(null===(t=p.current.flowData)||void 0===t?void 0:t._id)!==e&&async function(e,t,n){return await a.Jt("/bot/".concat(e,"/").concat(t,"/chat-flow/").concat(n))}(c,n,e).then(u)}),[e,n,c]),o.useEffect((()=>{!p.current.flowId&&t&&u(f(t))}),[t]);const h=o.useMemo((()=>{const e=[],t=[{id:d,type:"input",data:{label:"Chat window opened"},position:{x:10,y:10}}];if(!r)return{};const{_id:n,startFlowId:o,deployedAt:s,flows:a}=r;return o&&e.push({id:"start-handle",source:d,target:o,markerEnd:{type:l.TG.ArrowClosed}}),a.forEach(((n,o)=>{const s=o%4,a=Math.ceil(o/4),{designProps:c={}}=n;if(t.push({id:n.flowId,type:n.type,dragHandle:".header",data:n,position:c.position||{x:100*(s+1)+280*s,y:90*(a+1)+250*a}}),"options"===n.type)n.children.forEach((t=>{var o;const s=n.flowId,a=t.nextFlowId;t.id||(t.id=(0,i.OX)()),!t.leadEmail||null!==(o=t.settings)&&void 0!==o&&o.leadEmail||(t.settings?t.settings.leadEmail=t.leadEmail:t.settings={leadEmail:t.leadEmail},delete t.leadEmail);const c=t.id,r="".concat(s,"_").concat(c,"_").concat(a);e.push({id:r,source:s,target:a,type:"smoothstep",sourceHandle:c,markerEnd:{type:l.TG.ArrowClosed}})}));else{const t=n.flowId,o=n.nextFlowId,s="".concat(t,"_null_").concat(o);e.push({id:s,source:t,target:o,type:"smoothstep",markerEnd:{type:l.TG.ArrowClosed}})}})),{nodes:t,edges:e,flowData:r,flowId:n,allowDeploy:!s&&!!n,setFlowData:u}}),[r]);return h.organizationId=c,h.botId=n,h};function f(e){if(e)return{flows:[]}}var p=n(85668),h=n(44414);const v=function(e){let{title:t,style:n,selected:o,hideHandle:s,children:a}=e;return(0,h.jsxs)("div",{className:"flow-item-container"+(o?" selected":""),style:n,children:[(0,h.jsxs)("div",{className:"header",children:[(0,h.jsx)(l.h7,{type:"target",position:l.yX.Left}),(0,h.jsx)("span",{children:t})]}),(0,h.jsxs)("div",{className:"body",children:[!s&&(0,h.jsx)(l.h7,{type:"source",position:l.yX.Right}),a]})]})};const g=function(e){return(0,h.jsx)(v,{selected:e.selected,title:"Lead Form",children:"This will display lead form for the visitor."})};var w=n(8145);const y=function(e){let{field:t,value:n,placeholder:l="Please edit this text",onChange:s}=e;const[a,c]=o.useState(!1),[i,r]=o.useState(n),d=o.useCallback((()=>{c((e=>!e)),r(n)}),[n]),u=()=>{s(i,t),d()};return a?(0,h.jsx)(w.A,{autoFocus:!0,value:i,size:"small",onKeyUp:e=>e.stopPropagation(),placeholder:l,onBlur:u,onChange:e=>r(e.currentTarget.value)}):(0,h.jsx)("div",{className:"inline-edit"+(n?"":" placeholder"),onClick:d,children:n||l})};function x(e){const{data:t}=e,n=o.useContext(r),[l,s]=o.useState(t);o.useEffect((()=>{s(t)}),[t]);return{state:l,setState:s,setValue:(t,o)=>s((l=>{const s=(0,i.do)(l,o,t);return n.updateFlow(s,e),s}))}}const E=function(e){const{state:t,setValue:n}=x(e);return(0,h.jsx)(v,{selected:e.selected,title:"Message",style:{width:"250px",position:"relative"},children:(0,h.jsx)(y,{value:t.content,field:"content",onChange:n})})};var m=n(10226);const C=function(e){let{field:t,value:n,onChange:l,...s}=e;const[a,c]=o.useState(n);return o.useEffect((()=>{c(n)}),[n]),(0,h.jsx)(w.A,{value:a,size:"small",...s,onChange:e=>c(e.currentTarget.value),onBlur:()=>l(a,t)})};const _={leadForm:g,message:E,options:function(e){var t,n,s,a;const{state:c,setValue:r}=x(e),[d,u]=o.useState({title:"",subTitle:"",value:""}),f=(e,t)=>u((n=>(0,i.do)(n,t,e)));return(0,h.jsxs)(v,{title:"Options",selected:e.selected,style:{width:"250px"},handleId:c.flowId,hideHandle:!0,children:[(0,h.jsx)("span",{children:"Display Text"}),(0,h.jsx)(C,{placeholder:"Display Text",value:c.displayText,field:"displayText",onChange:r}),(0,h.jsx)("span",{children:"Property Name"}),(0,h.jsx)(C,{placeholder:"Property Name",value:c.property,field:"property",onChange:r}),(0,h.jsx)("span",{children:"Message"}),(0,h.jsx)(C,{placeholder:"Display Text",value:c.content,field:"content",onChange:r}),(0,h.jsxs)("fieldset",{children:[(0,h.jsx)("legend",{children:"Add Options"}),(0,h.jsx)(C,{placeholder:"Option Title",value:d.title,field:"title",onChange:f}),(0,h.jsx)(C,{placeholder:"Option Subtitle",value:d.subTitle,field:"subTitle",onChange:f}),(0,h.jsx)(C,{placeholder:"Option value",value:d.value,field:"value",onChange:f}),(0,h.jsx)("span",{children:"Lead Email"}),(0,h.jsx)(C,{placeholder:"To Mail Id",value:null===(t=d.settings)||void 0===t||null===(n=t.leadEmail)||void 0===n?void 0:n.to,field:"settings.leadEmail.to",onChange:f}),(0,h.jsx)(C,{placeholder:"CC Mail Id",value:null===(s=d.settings)||void 0===s||null===(a=s.leadEmail)||void 0===a?void 0:a.cc,field:"settings.leadEmail.cc",onChange:f}),(0,h.jsx)(m.A,{size:"small",type:"button",variant:"contained",color:"success",onClick:()=>{r(d,"children.".concat(c.children.length)),u({title:"",subTitle:"",value:""})},children:"+"})]}),(0,h.jsx)("div",{children:c.children.map((e=>(0,h.jsxs)("div",{style:{width:"100%",padding:"4px 10px",border:"1px solid grey",borderRadius:"6px",margin:"10px 0",position:"relative"},children:[(0,h.jsx)("span",{children:e.title}),(0,h.jsx)(l.h7,{type:"source",position:l.yX.Right,id:e.id})]},e.id)))})]})},start:function(){return(0,h.jsx)("div",{children:"Start"})},gpt:function(e){return(0,h.jsx)(v,{selected:e.selected,title:"GPT Handler",children:"From here on visitors query would be handled by GPT"})},stop:function(e){return(0,h.jsx)(v,{selected:e.selected,title:"Stop Chat",hideHandle:!0,children:"The chat will stop here"})}};var A=n(93383);const T=function(e){let{name:t,type:n}=e;return(0,h.jsx)("div",{className:"flow-item",onDragStart:e=>{e.dataTransfer.setData("application/reactflow",n),e.dataTransfer.effectAllowed="move"},draggable:!0,children:t})};const j=function(e){let{list:t,onChange:n}=e;return t?(0,h.jsx)("div",{children:(0,h.jsx)("select",{onChange:e=>n(e.currentTarget.value),style:{width:"100%"},children:t.map(((e,t)=>(0,h.jsx)("option",{value:e.value,children:e.label},t)))})}):"Loading..."};const b=function(){const e=o.useContext(r);return(0,h.jsxs)("div",{className:"control-panel",children:[(0,h.jsx)("div",{children:(0,h.jsx)(j,{list:e.getFlowList(),onChange:e.selectFlow})}),(0,h.jsxs)("div",{className:"flow-items-list",children:[(0,h.jsx)(T,{name:"Message",type:"message"}),(0,h.jsx)(T,{name:"Options List",type:"options"}),(0,h.jsx)(T,{name:"Lead Form",type:"leadForm"}),(0,h.jsx)(T,{name:"Lead Flow",type:"leadFlow"}),(0,h.jsx)(T,{name:"GPT",type:"gpt"}),(0,h.jsx)(T,{name:"Stop",type:"stop"})]}),(0,h.jsxs)("div",{className:"buttons",children:[(0,h.jsx)(A.A,{variant:"contained",fullWidth:!0,color:"primary",onClick:e.saveFlow,children:"Save"}),e.allowDeploy()&&(0,h.jsx)(A.A,{variant:"contained",fullWidth:!0,style:{marginTop:"8px"},color:"secondary",onClick:e.deployFlow,children:"Deploy"})]})]})};n(522);const I=function(e){let{flowData:t}=e;const n=o.useContext(r),[s,a,c]=(0,l.ck)(t.nodes),[d,u,f]=(0,l.fM)(t.edges),[v,g]=o.useState(null),w=o.useRef({context:n});w.current.context=n,w.current.setNodes=a,w.current.onNodesChange=c,w.current.setEdges=u,w.current.reactFlowInstance=v,w.current.edges=d,o.useEffect((()=>{const{setNodes:e,setEdges:n}=w.current;e(t.nodes),n(t.edges)}),[t]),(0,l.p4)({onChange:e=>{w.current.selectedItems=e}});const y=o.useCallback((e=>u((t=>(0,l.rN)(e,t)))),[u]);w.current.onConnect=y;const x=o.useCallback((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),E=o.useCallback((e=>{e.preventDefault();const t=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof t||!t)return;const{context:n,setNodes:o,reactFlowInstance:l}=w.current,s=l.screenToFlowPosition({x:e.clientX,y:e.clientY}),a=function(e){let t={flowId:(0,i.OX)(),type:e};"options"===e?t={...t,children:[],content:"",property:"",displayText:""}:"message"===e&&(t={...t,content:""});return t}(t),c={id:a.flowId,type:t,position:s,data:a};n.updateFlow(c.data,c),o((e=>e.concat(c)))}),[]),m=o.useCallback((function(e){const{context:t,onNodesChange:n,reactFlowInstance:o}=w.current;if(o){const n=e=>{if(!e)return;const{id:n,position:o}=e;n&&o&&t.updateFlowProperties(n,"designProps.position",o)};Array.isArray(e)?e.forEach(n):n(e)}for(var l=arguments.length,s=new Array(l>1?l-1:0),a=1;a<l;a++)s[a-1]=arguments[a];n(e,...s)}),[]),C=o.useCallback((function(e){const{context:t,onConnect:n}=w.current;t.updateFlowLink(e);for(var o=arguments.length,l=new Array(o>1?o-1:0),s=1;s<o;s++)l[s-1]=arguments[s];n(e,...l)}),[]),A=o.useCallback((e=>{var t;if("delete"===(null===(t=e.code)||void 0===t?void 0:t.toLowerCase())){var n;const{context:e,selectedItems:t,edges:o,setNodes:l,setEdges:s}=w.current;if(!t)return;const{nodes:a}=t;let{edges:c}=t;if(c=[...c],null!==a&&void 0!==a&&a.length&&null!==o&&void 0!==o&&o.length){const e=a.map((e=>e.id)),t=o.filter((t=>e.includes(t.target)));t.length&&c.push(...t)}if(e.remove({nodes:a,edges:c}),null!==a&&void 0!==a&&a.length){const e=a.map((e=>e.id));l((t=>t.filter((t=>!e.includes(t.id)))))}if(null!==(n=c)&&void 0!==n&&n.length){const e=c.map((e=>e.id));s((t=>t.filter((t=>!e.includes(t.id)))))}}}),[]);return(0,h.jsxs)("div",{className:"flow-design-container",children:[(0,h.jsx)("div",{className:"flow-board",onKeyUp:A,children:(0,h.jsx)(l.Gc,{nodes:s,edges:d,onNodesChange:m,onEdgesChange:f,onConnect:C,onInit:g,onDrop:E,onDragOver:x,fitView:!0,attributionPosition:"top-right",nodeTypes:_,proOptions:{hideAttribution:!0},children:(0,h.jsx)(p.V,{color:"#aaa",gap:16})})}),(0,h.jsx)(b,{})]})};const P=function(){const[e,t]=o.useState(),[n,d]=o.useState("");o.useEffect((()=>{(async function(){const{selectedBotId:e,organizationId:t}=s.nc.getState();return(await a.Jt("/bot/".concat(t,"/").concat(e,"/chat-flow"))).map(c)})().then((e=>{var n;t(e),d(null===(n=e[0])||void 0===n?void 0:n.value)}))}),[]);const f=u(n,0===(null===e||void 0===e?void 0:e.length)),{flowData:p}=f||{},[v,g]=o.useState(p),w=o.useRef({});w.current.flowList=e,w.current.flow=f,w.current.state=v,o.useEffect((()=>{g(p)}),[p]);const y=o.useMemo((()=>{const e=async e=>{var n;const{state:o,flow:l}=w.current,s=await async function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const l="/bot/".concat(e,"/").concat(t,"/chat-flow").concat(o?"?deploy=true":"");return await a.bE(l,n)}(l.organizationId,l.botId,o,!0===e);let i=[...w.current.flowList];const r=i.findIndex((e=>e.value===s._id)),u=c(s);var f,p;(r>=0?i[r]=u:i.splice(0,0,u),e||(null===(n=w.current.flow)||void 0===n?void 0:n.flowId)!==s._id)&&(t(i),d(s._id),null===(f=w.current.flow)||void 0===f||null===(p=f.setFlowData)||void 0===p||p.call(f,s))};return{getFlowList:()=>w.current.flowList,selectFlow:d,updateFlow:(e,t)=>{const{xPos:n,yPos:o}=t||{},{x:l,y:s}=(null===t||void 0===t?void 0:t.position)||{x:n,y:o};g((t=>{const n=[...t.flows];t={...t,flows:n};const o=n.findIndex((t=>t.flowId===e.flowId));return o>=0?n[o]=e:n.push(e),(0,i.do)(t,"designProps.position",{x:l,y:s})}))},updateFlowProperties:(e,t,n)=>{g((o=>{const l=o.flows.findIndex((t=>t.flowId===e));return l>=0?(0,i.do)(o,"flows.".concat(l,".").concat(t),n):o}))},updateFlowLink:e=>{if(!e)return;const t={...w.current.state};let n=!1;const o=e=>{const{source:o,sourceHandle:l,target:s}=e;S(t,o,l,s),n=!0};Array.isArray(e)?e.forEach(o):o(e),n&&g(t)},remove:e=>{let{nodes:t,edges:n}=e;if((null===t||void 0===t||!t.length)&&(null===n||void 0===n||!n.length))return;const o={...w.current.state};if(null===n||void 0===n||n.forEach((e=>{const{source:t,sourceHandle:n}=e;S(o,t,n)})),null!==t&&void 0!==t&&t.length){const e=t.map((e=>e.id));o.flows=o.flows.filter((t=>!e.includes(t.flowId)))}g(o)},allowDeploy:()=>{var e;return null===(e=w.current.flow)||void 0===e?void 0:e.allowDeploy},saveFlow:()=>e(!1),deployFlow:()=>e(!0)}}),[]);if(p)return(0,h.jsx)(r.Provider,{value:y,children:(0,h.jsx)(l.Ln,{children:(0,h.jsx)(I,{flowData:f})})})};function S(e,t,n,o){if(t===d)e.startFlowId=o||void 0;else{const s=e.flows.findIndex((e=>e.flowId===t));if(s>=0){const t={...e.flows[s]};if(e.flows=[...e.flows],e.flows[s]=t,n){if(t.children){var l;const e=null===(l=t.children)||void 0===l?void 0:l.findIndex((e=>e.id===n));if(e>=0){t.children[e].nextFlowId=o||void 0}}}else t.nextFlowId=o||void 0}}}},8478:(e,t,n)=>{n.d(t,{Jt:()=>s,TF:()=>i,bE:()=>a,yJ:()=>c});var o=n(32026),l=n(44364);async function s(e,t){return r("GET",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function a(e,t){return r("POST",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function c(e,t){return r("PUT",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function i(e,t){return r("DELETE",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function r(e,t,n){let{headers:o,noAuth:l,...s}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a="POST"===e||"PUT"===e||"DELETE"===e;t=function(e,t){if(!e)return e;const n=t&&Object.keys(t);if(null!==n&&void 0!==n&&n.length){const o=n.reduce(((e,n)=>{let o=t[n];return null===o||void 0===o?e:(o="".concat(n,"=").concat(encodeURIComponent(o)),e?"".concat(e,"&").concat(o):o)}),"");o&&(e="".concat(e).concat(e.includes("?")?"&":"?").concat(o))}if(e.startsWith("https://"))return e;return"".concat(d).concat(e)}(t,a?void 0:n);const c=n instanceof FormData;if(c||(n=n&&"object"===typeof n&&a?JSON.stringify(n):void 0),o||(o={}),c||(o["Content-Type"]="application/json"),o.Accept="application/json",!1!==l){const e=sessionStorage.getItem("token");e&&(o.Authorization="Bearer ".concat(e))}try{const l=await fetch(t,{...s,headers:o,body:n,method:e}),a=await l.json();if(l.ok){const{data:e,...t}=a;return delete t.status,e&&!Object.keys(t).length?e:a}throw a.message?new Error(a.message):a}catch(r){var i;throw console.error("Error calling API: ",r),null!==(i=r.message)&&void 0!==i&&i.includes("fetch")?new Error("Unable to reach server. Please check your network connectivity and try again."):new Error(r.message)}}const d=(0,o.s8)(l.jn,"/")},32026:(e,t,n)=>{function o(e,t){return e.replace(new RegExp("".concat(l(t),"+$")),"")}function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s(e){const t=new Date(e),n=t.getDate(),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],l=t.getFullYear();return"".concat(o," ").concat(n,", ").concat(l)}function a(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const l=t.indexOf("."),s=t.substring(0,l),c=t.substring(l+1);o[s]=a(e[s],c,n)}else o[t]=n;return o}function c(e,t){return btoa("".concat(e,"_").concat(t,"_whatsapp_int"))}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(36*Math.random()));return n}function r(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const l=t.indexOf("."),s=t.substring(0,l),a=t.substring(l+1);o[s]=r(e[s],a,n)}else o[t]=n;return o}function d(e,t){const n=new Blob([e],{type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/csv"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)}n.d(t,{G6:()=>a,OX:()=>i,PE:()=>d,Yq:()=>s,do:()=>r,qW:()=>c,s8:()=>o})},44364:(e,t,n)=>{n.d(t,{DX:()=>c,Og:()=>s,jn:()=>o,pA:()=>a,pR:()=>l});const o="https://devbackend.livhousing.com:444",l="c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",s={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.TRAINING_MEDIA_MAXSIZE,a={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.CONVERSATION_MEDIA_MAXSIZE,c={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.REACT_APP_NGROK_BACKEND_URL||"https://devbackend.livhousing.com:444"}}]);