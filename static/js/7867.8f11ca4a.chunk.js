"use strict";(self.webpackChunklib_prop_ui=self.webpackChunklib_prop_ui||[]).push([[7867],{93383:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(9950),a=n(10226),s=n(46639),c=n(44414);const i=function(e){let{onClick:t,disabled:n,isLoading:i,children:r,...l}=e;const[d,u]=o.useState(i);return(0,c.jsxs)(a.A,{onClick:e=>{if(!t)return;const n=t(e);"function"===typeof(null===n||void 0===n?void 0:n.finally)&&(u(!0),n.finally((()=>u(!1))))},disabled:d||i||n,...l,children:[(d||i)&&(0,c.jsx)(s.A,{size:16,color:"primary",style:{marginRight:"10px"}}),r]})}},69208:(e,t,n)=>{n.r(t),n.d(t,{default:()=>m});var o=n(9950),a=n(39320),s=n(33340),c=n(8478);async function i(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a=n._id||"",s="/bot/".concat(e,"/").concat(t,"/chat-flow/").concat(a).concat(o?"?deploy=true":"");return a?await c.yJ(s):await c.bE(s)}const r=o.createContext({});const l=function(e){const t=(0,s.nc)((e=>e.selectedBotId)),n=(0,s.nc)((e=>e.organizationId)),[i,r]=o.useState();o.useEffect((()=>{(async function(e,t,n){return await c.Jt("/bot/".concat(e,"/").concat(t,"/chat-flow/").concat(n))})(n,t,e).then(r)}),[e,t,n]);const l=o.useMemo((()=>{const e=[],t=[{id:"start-web",type:"input",data:{label:"Chat loaded"},position:{x:10,y:10}}];if(!i)return{};const{startFlowId:n,flows:o}=i;return n&&e.push({id:"start-handle",source:"start-web",target:n,markerEnd:{type:a.TG.ArrowClosed}}),o.forEach(((n,o)=>{const s=o%4,c=Math.ceil(o/4),{designProps:i={}}=n;t.push({id:n.flowId,type:n.type,dragHandle:".header",data:n,position:i.position||{x:100*(s+1)+280*s,y:90*(c+1)+250*c}}),"options"===n.type&&n.children.forEach(((t,o)=>{const s=n.flowId,c=t.nextFlowId,i="handle-".concat(t.id||"idx-"+o),r="".concat(s,"_").concat(c,"_").concat(i);e.push({id:r,source:s,target:c,type:"smoothstep",sourceHandle:i,markerEnd:{type:a.TG.ArrowClosed}})}))})),{nodes:t,edges:e,flowData:i}}),[i]);return l.organizationId=n,l.botId=t,l};var d=n(85668),u=n(44414);const p=function(e){let{title:t,style:n,hideHandle:o,children:s}=e;return(0,u.jsxs)("div",{className:"flow-item-container",style:n,children:[(0,u.jsxs)("div",{className:"header",children:[(0,u.jsx)(a.h7,{type:"target",position:a.yX.Left}),(0,u.jsx)("span",{children:t})]}),(0,u.jsxs)("div",{className:"body",children:[!o&&(0,u.jsx)(a.h7,{type:"source",position:a.yX.Right}),s]})]})};const f=function(){return(0,u.jsx)(p,{title:"Lead Form",children:"This will display lead form for the visitor."})};var h=n(8145);const g=function(e){let{field:t,value:n,placeholder:a="Please edit this text",onChange:s}=e;const[c,i]=o.useState(!1),[r,l]=o.useState(n),d=o.useCallback((()=>{i((e=>!e)),l(n)}),[n]),p=()=>{s(r,t),d()};return c?(0,u.jsx)(h.A,{autoFocus:!0,value:r,size:"small",placeholder:a,onBlur:p,onChange:e=>l(e.currentTarget.value)}):(0,u.jsx)("div",{className:"inline-edit"+(n?"":" placeholder"),onClick:d,children:n||a})};var v=n(32026);function x(e){const{data:t}=e,n=o.useContext(r),[a,s]=o.useState(t);o.useEffect((()=>{s(t)}),[t]);return{state:a,setState:s,setValue:(t,o)=>s((a=>{const s=(0,v.do)(a,o,t);return n.updateFlow(s,e),s}))}}const y=function(e){const{state:t,setValue:n}=x(e);return(0,u.jsx)(p,{title:"Message",style:{width:"250px",position:"relative"},children:(0,u.jsx)(g,{value:t.content,field:"content",onChange:n})})};var E=n(10226);const _=function(e){let{field:t,value:n,onChange:a,...s}=e;const[c,i]=o.useState(n);return o.useEffect((()=>{i(n)}),[n]),(0,u.jsx)(h.A,{value:c,size:"small",...s,onChange:e=>i(e.currentTarget.value),onBlur:()=>a(c,t)})};const w={form:f,message:y,options:function(e){var t,n,s,c;const{state:i,setValue:r}=x(e),[l,d]=o.useState({title:"",value:""}),f=(e,t)=>d((n=>(0,v.do)(n,t,e)));return(0,u.jsxs)(p,{title:"Options",style:{width:"250px"},handleId:i.flowId,hideHandle:!0,children:[(0,u.jsx)("span",{children:"Display Text"}),(0,u.jsx)(_,{placeholder:"Display Text",value:i.displayText,field:"displayText",onChange:r}),(0,u.jsx)("span",{children:"Property Name"}),(0,u.jsx)(_,{placeholder:"Property Name",value:i.property,field:"property",onChange:r}),(0,u.jsx)("span",{children:"Message"}),(0,u.jsx)(_,{placeholder:"Display Text",value:i.content,field:"content",onChange:r}),(0,u.jsxs)("fieldset",{children:[(0,u.jsx)("legend",{children:"Add Options"}),(0,u.jsx)(_,{placeholder:"Option Title",value:l.title,field:"title",onChange:f}),(0,u.jsx)(_,{placeholder:"Option Subtitle",value:l.subTitle,field:"subTitle",onChange:f}),(0,u.jsx)(_,{placeholder:"Option value",value:l.value,field:"value",onChange:f}),(0,u.jsx)("span",{children:"Lead Email"}),(0,u.jsx)(_,{placeholder:"To Mail Id",value:null===(t=l.settings)||void 0===t||null===(n=t.leadEmail)||void 0===n?void 0:n.to,field:"settings.leadEmail.to",onChange:f}),(0,u.jsx)(_,{placeholder:"CC Mail Id",value:null===(s=l.settings)||void 0===s||null===(c=s.leadEmail)||void 0===c?void 0:c.cc,field:"settings.leadEmail.cc",onChange:f}),(0,u.jsx)(E.A,{size:"small",type:"button",variant:"contained",color:"success",onClick:()=>{r(l,"children.".concat(i.children.length)),d({title:"",value:""})},children:"+"})]}),(0,u.jsx)("div",{children:i.children.map(((e,t)=>{const n="handle-".concat(e.id||"idx-"+t);return(0,u.jsxs)("div",{style:{width:"100%",padding:"4px 10px",border:"1px solid grey",borderRadius:"6px",margin:"10px 0",position:"relative"},children:[(0,u.jsx)("span",{children:e.title}),(0,u.jsx)(a.h7,{type:"source",position:a.yX.Right,id:n})]},e.value)}))})]})},start:function(){return(0,u.jsx)("div",{children:"Start"})},gpt:function(){return(0,u.jsx)(p,{title:"GPT Handler",children:"From here on visitors query would be handled by GPT"})}};const A=function(e){let{name:t,type:n}=e;return(0,u.jsx)("div",{className:"flow-item",onDragStart:e=>{e.dataTransfer.setData("application/reactflow",n),e.dataTransfer.effectAllowed="move"},draggable:!0,children:t})};n(522);var C=n(93383);const T=function(e){let{flowData:t}=e;const n=o.useContext(r),[s,c,i]=(0,a.ck)(t.nodes),[l,p,f]=(0,a.fM)(t.edges),[h,g]=o.useState(null),x=o.useRef({context:n});x.current.context=n,x.current.setNodes=c,x.current.onNodesChange=i,x.current.setEdges=p,x.current.onEdgesChange=f,x.current.reactFlowInstance=h,o.useEffect((()=>{const{setNodes:e,setEdges:n}=x.current;e(t.nodes),n(t.edges)}),[t]);const y=o.useCallback((e=>p((t=>(0,a.rN)(e,t)))),[p]),E=o.useCallback((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),_=o.useCallback((e=>{e.preventDefault();const t=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof t||!t)return;const{context:n,setNodes:o,reactFlowInstance:a}=x.current,s=a.screenToFlowPosition({x:e.clientX,y:e.clientY}),c=function(e){let t={flowId:(0,v.OX)(),type:e};"options"===e?t={...t,children:[],content:"",property:"",displayText:""}:"message"===e&&(t={...t,content:"Edit this message with the message to be sent to visitors."});return t}(t),i={id:c.flowId,type:t,position:s,data:c};n.updateFlow(i.data,i),o((e=>e.concat(i)))}),[]),T=o.useCallback((function(e){const{context:t,onNodesChange:n,reactFlowInstance:o}=x.current;if(o){const n=e=>{if(!e)return;const{id:n,position:o}=e;n&&o&&t.updateFlowProperties(n,"designProps.position",o)};Array.isArray(e)?e.forEach(n):n(e)}for(var a=arguments.length,s=new Array(a>1?a-1:0),c=1;c<a;c++)s[c-1]=arguments[c];n(e,...s)}),[]),m=o.useCallback((function(){const{onEdgesChange:e}=x.current;e(...arguments)}),[]);return(0,u.jsxs)("div",{className:"flow-design-container",children:[(0,u.jsx)("div",{className:"flow-board",children:(0,u.jsx)(a.Gc,{nodes:s,edges:l,onNodesChange:T,onEdgesChange:m,onConnect:y,onInit:g,onDrop:_,onDragOver:E,fitView:!0,attributionPosition:"top-right",nodeTypes:w,proOptions:{hideAttribution:!0},children:(0,u.jsx)(d.V,{color:"#aaa",gap:16})})}),(0,u.jsxs)("div",{className:"control-panel",children:[(0,u.jsxs)("div",{className:"flow-items-list",children:[(0,u.jsx)(A,{name:"Start",type:"start"}),(0,u.jsx)(A,{name:"Options List",type:"options"}),(0,u.jsx)(A,{name:"Lead Form",type:"form"}),(0,u.jsx)(A,{name:"GPT",type:"gpt"})]}),(0,u.jsxs)("div",{className:"buttons",children:[(0,u.jsx)(C.A,{variant:"contained",fullWidth:!0,color:"primary",onClick:n.saveFlow,children:"Save"}),(0,u.jsx)(C.A,{variant:"contained",fullWidth:!0,style:{marginTop:"8px"},color:"secondary",onClick:n.deployFlow,children:"Deploy"})]})]})]})};const m=function(){const e=l("6607e2103803f98831d14394"),{flowData:t}=e||{},[n,a]=o.useState(t),s=o.useRef({});s.current.flow=e,s.current.state=n,o.useEffect((()=>{a(t)}),[t]);const c=o.useMemo((()=>({updateFlow:(e,t)=>{const{xPos:n,yPos:o}=t||{},{x:s,y:c}=(null===t||void 0===t?void 0:t.position)||{x:n,y:o};a((t=>{const n=[...t.flows];t={...t,flows:n};const o=n.findIndex((t=>t.flowId===e.flowId));return o>=0?n[o]=e:n.push(e),(0,v.do)(t,"designProps.position",{x:s,y:c})}))},updateFlowProperties:(e,t,n)=>{a((o=>{const a=o.flows.findIndex((t=>t.flowId===e));return a>=0?(0,v.do)(o,"flows.".concat(a,".").concat(t),n):o}))},saveFlow:()=>{const{state:e,flow:t}=s.current;return i(t.organizationId,t.botId,e)},deployFlow:()=>{const{state:e,flow:t}=s.current;return i(t.organizationId,t.botId,e,!0)}})),[]);if(t)return(0,u.jsx)(r.Provider,{value:c,children:(0,u.jsx)(T,{flowData:e})})}},8478:(e,t,n)=>{n.d(t,{Jt:()=>s,Ne:()=>u,TF:()=>r,bE:()=>c,yJ:()=>i});var o=n(32026),a=n(44364);async function s(e,t){return l("GET",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function c(e,t){return l("POST",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function i(e,t){return l("PUT",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function r(e,t){return l("DELETE",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function l(e,t,n){let{headers:o,noAuth:a,...s}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const c="POST"===e||"PUT"===e||"DELETE"===e;t=u(t,c?void 0:n);const i=n instanceof FormData;if(i||(n=n&&"object"===typeof n&&c?JSON.stringify(n):void 0),o||(o={}),i||(o["Content-Type"]="application/json"),o.Accept="application/json",!1!==a){const e=sessionStorage.getItem("token");e&&(o.Authorization="Bearer ".concat(e))}try{const a=await fetch(t,{...s,headers:o,body:n,method:e}),c=await a.json();if(a.ok){const{data:e,...t}=c;return delete t.status,e&&!Object.keys(t).length?e:c}throw c.message?new Error(c.message):c}catch(l){var r;throw console.error("Error calling API: ",l),null!==(r=l.message)&&void 0!==r&&r.includes("fetch")?new Error("Unable to reach server. Please check your network connectivity and try again."):new Error(l.message)}}const d=(0,o.s8)(a.jn,"/");function u(e,t){if(!e)return e;const n=t&&Object.keys(t);if(null!==n&&void 0!==n&&n.length){const o=n.reduce(((e,n)=>{let o=t[n];return null===o||void 0===o?e:(o="".concat(n,"=").concat(encodeURIComponent(o)),e?"".concat(e,"&").concat(o):o)}),"");o&&(e="".concat(e).concat(e.includes("?")?"&":"?").concat(o))}return e.startsWith("https://")?e:"".concat(d).concat(e)}},32026:(e,t,n)=>{function o(e,t){return e.replace(new RegExp("".concat(a(t),"+$")),"")}function a(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s(e){const t=new Date(e),n=t.getDate(),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getFullYear();return"".concat(o," ").concat(n,", ").concat(a)}function c(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const a=t.indexOf("."),s=t.substring(0,a),i=t.substring(a+1);o[s]=c(e[s],i,n)}else o[t]=n;return o}function i(e,t){return btoa("".concat(e,"_").concat(t,"_whatsapp_int"))}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(36*Math.random()));return n}function l(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const a=t.indexOf("."),s=t.substring(0,a),c=t.substring(a+1);o[s]=l(e[s],c,n)}else o[t]=n;return o}n.d(t,{G6:()=>c,OX:()=>r,Yq:()=>s,do:()=>l,qW:()=>i,s8:()=>o})},44364:(e,t,n)=>{n.d(t,{DX:()=>i,Og:()=>s,jn:()=>o,pA:()=>c,pR:()=>a});const o="https://devbackend.livhousing.com",a="c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",s={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com"}.TRAINING_MEDIA_MAXSIZE,c={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com"}.CONVERSATION_MEDIA_MAXSIZE,i={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com"}.REACT_APP_NGROK_BACKEND_URL||"https://devbackend.livhousing.com"}}]);