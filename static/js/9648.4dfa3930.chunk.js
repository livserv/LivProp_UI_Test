"use strict";(self.webpackChunklib_prop_ui=self.webpackChunklib_prop_ui||[]).push([[9648],{9648:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Q});var s=a(9950),l=a(28564),r=a(39320),n=a(37630),o=a(85668);a(522);const i=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),d=e=>{const t={};return e.message?(e.message.length<3||e.message.length>500)&&(t.message="Message must be between 3 and 500 characters"):t.message="Message is required",t},c=e=>{const t={};return e.message?(e.message.length<3||e.message.length>500)&&(t.message="Message must be between 3 and 500 characters"):t.message="Message is required",e.subOptions.forEach(((e,a)=>{var s;(!e.title||e.title.length<3||e.title.length>50)&&(t[`title_${a}`]="Title must be between 3 and 50 characters"),(!e.value||e.value.length<3||e.value.length>500)&&(t[`value_${a}`]="Value must be between 3 and 500 characters");const l=new Set;e.leadEmailTo&&!i(e.leadEmailTo.trim())?t[`leadEmailTo_${a}`]="Lead Email To must be a valid email":l.has(e.leadEmailTo.trim())?t[`leadEmailTo_${a}`]="Duplicate Lead Email To":l.add(e.leadEmailTo.trim()),(null===(s=e.leadEmailCc)||void 0===s?void 0:s.length)>0&&e.leadEmailCc.forEach(((e,s)=>{i(e)?l.has(e)?t[`subOptions[${a}].leadEmailCc[${s}]`]="Duplicate email in Lead Email Cc":l.add(e):t[`subOptions[${a}].leadEmailCc[${s}]`]="Invalid email format"}))})),t},u=e=>{const t={};(!e.message||e.message.length<3||e.message.length>500)&&(t.message="Message must be between 3 and 500 characters");const a=e.url&&h(e.url),s=e.files&&p(e.files,e.fileType);return a||s||(t.fileOrUrl="Either a valid URL or valid files must be provided"),s&&!e.fileType&&(t.fileType="File type is required"),t},m=e=>{const t={};return(!e.message||e.message.length<3||e.message.length>500)&&(t.message="Message must be between 3 and 500 characters"),e.url&&h(e.url)||(t.url="URL must be valid"),t},p=(e,t)=>{if(!e||0===e.length)return!1;const a={pdf:"pdf",images:["jpg","jpeg","png","gif"],video:["mp4","avi","mov"]}[t];return e.every((e=>{var t;const s=null===(t=e.name.split(".").pop())||void 0===t?void 0:t.toLowerCase();return Array.isArray(a)?a.includes(s||""):s===a}))},h=e=>/^(http|https|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(e),g=(e,t)=>{switch(e){case"message":if(!t)return"Message is required";if(t.length<3)return"Message must be at least 3 characters";if(t.length>500)return"Message must be at most 500 characters";break;case"title":if(!t)return"Title is required";if(t.length<3)return"Title must be at least 3 characters";if(t.length>50)return"Title must be at most 50 characters";break;case"value":if(!t)return"Value is required";if(t.length<3)return"Value must be at least 3 characters";if(t.length>500)return"Value must be at most 500 characters";break;case"leadEmailTo":if(t&&!/\S+@\S+\.\S+/.test(t))return"Lead Email To is invalid";break;case"leadEmailCc":if(t&&!/\S+@\S+\.\S+/.test(t))return"Lead Email CC is invalid"}return""},x=e=>{const t={};switch(e.message||(t.message="A question must be selected."),e.message){case"Can you provide me your contact number":break;case"May I know your age":{var a;const s=parseInt(null===(a=e.answer)||void 0===a?void 0:a.trim(),10);(isNaN(s)||s<18||s>99)&&(t.answer="Enter a valid age between 18 and 99.");break}case"When would you like to travel":{const a=new Date(new Date(e.answer).setHours(0,0,0,0)),s=new Date((new Date).setHours(0,0,0,0)),l=new Date(s);l.setMonth(s.getMonth()+3),(isNaN(a.getTime())||a<s||a>l)&&(t.answer="Enter a valid date between today and the next 3 months.");break}case"May I know which city you would like to visit":{var s;const a=null===(s=e.answer)||void 0===s?void 0:s.trim();(!a||a.length<3||a.length>50)&&(t.answer="Enter a city name between 3 and 50 characters.");break}default:e.answer||(t.answer="An answer is required.")}return t};var b=a(44414);const f=e=>{let{messages:t}=e;const[a,l]=(0,s.useState)(Object.entries(t));return(0,b.jsxs)(b.Fragment,{children:[a.map(((e,t)=>{let[s,l]=e;return(0,b.jsxs)("small",{className:"mr-2",children:[l,a.length>1&&t<a.length-1?"; ":""]},s)})),a.length>1&&(0,b.jsx)("button",{onClick:()=>l([]),className:"absolute w-4 h-4 rounded bg-red-500 hover:bg-red-700 top-0 right-0 mt-1 mr-2 text-white",children:"\xd7"})]})},v=e=>{let{data:t}=e;const{node:a,handleChange:l,onDelete:n}=t,[o,i]=(0,s.useState)(a.data.message),[d,c]=(0,s.useState)(!1),u=()=>{c(!0)};return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center border-b pb-2 py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("span",{children:"Message"}),(0,b.jsx)("button",{className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px",title:"Delete Message Node",onClick:()=>n(a.id),children:"\xd7"})]}),(0,b.jsx)("div",{className:"space-y-4 py-2 px-2 pb-3 min-w-36",children:d?(0,b.jsx)("textarea",{value:o,onChange:e=>{const t=e.target.value;i(t),l(a.id,{message:t})},onBlur:()=>{c(!1)},placeholder:"Enter your message",className:"w-full p-2 border border-gray-600 bg-gray-700 text-white rounded"}):(0,b.jsxs)("div",{className:"flex items-center space-x-2",onDoubleClick:u,children:[o||"Enter your message",(0,b.jsx)("div",{onClick:u,children:(0,b.jsx)("svg",{className:"w-4 h-4 text-white cursor-pointer hover:text-white ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{d:"M7.127 22.562l-7.127 1.438 1.438-7.128 5.689 5.69zm1.414-1.414l11.228-11.225-5.69-5.692-11.227 11.227 5.689 5.69zm9.768-21.148l-2.816 2.817 5.691 5.691 2.816-2.819-5.691-5.689z"})})})]})}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"})]})};a(4064);const w=e=>{let{data:t,id:a}=e;const{onDelete:s}=t;return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center border-b pb-2 py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Lead Form"}),(0,b.jsx)("button",{title:"Delete Lead Form Node",className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px",onClick:()=>s(a),children:"\xd7"})]}),(0,b.jsx)("div",{className:"space-y-4 py-2 px-2 pb-3",children:(0,b.jsx)("p",{children:"This will display lead form for the visitor"})}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"})]})},y=e=>{let{data:t,id:a}=e;const{onDelete:s}=t;return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 py-2 px-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Lead Flow"}),(0,b.jsx)("button",{title:"Delete Lead Flow Node",className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px",onClick:()=>s(a),children:"\xd7"})]}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"})]})},j=e=>{let{data:t,id:a}=e;const{onDelete:s}=t;return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center border-b pb-2 py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"GPT Handler"}),(0,b.jsx)("button",{className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px",title:"Delete GPT Handler Node",onClick:()=>s(a),children:"\xd7"})]}),(0,b.jsx)("div",{className:"space-y-4 py-2 px-2 pb-3",children:(0,b.jsx)("p",{children:"From here on visitors would be handled by GPT"})}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Left,className:"w-2 h-2 bg-white border-none"})]})},N=e=>{let{data:t,id:a}=e;const{onDelete:s,stop:l}=t;return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("span",{children:"Stop"}),(0,b.jsx)("button",{className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px",title:"Delete Stop Node",onClick:()=>s(a),children:"\xd7"})]}),(0,b.jsx)("div",{className:"space-y-4 py-2 px-2 pb-3 min-w-36",children:l||"The chat will stop here"}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"})]})},C=e=>{let{data:t}=e;const{message:a}=t.node.data;return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white p-2 rounded-md shadow-lg",children:[(0,b.jsx)("div",{className:"custom-node-body text-center",children:a}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"})]})},E=e=>{let{id:t,data:a}=e;const{node:l,onDelete:n,handleChange:o}=a,[i,d]=(0,s.useState)({}),[c,u]=(0,s.useState)("application/pdf"),m=(e,t)=>{const a=((e,t)=>{switch(e){case"message":if(!t)return"Message is required";if(t.length<3)return"Message must be at least 3 characters";if(t.length>500)return"Message must be at most 500 characters";break;case"fileType":if(!t)return"File Type is required";break;case"files":if(!t||0===t.length)return"At least one file must be uploaded";break;case"url":if(!t)return"URL is required if no files are uploaded";break;default:return""}return""})(e,t);d((t=>({...t,[e]:a})))},p=(e,t)=>{const a={...l.data,[e]:t};if(o(l.id,a),"files"===e&&t.length>0&&(a.url="",d((e=>({...e,url:""})))),"url"===e&&t&&(a.files=[],d((e=>({...e,files:""})))),l.data=a,"fileType"===e){const e=h(t);u(e)}},h=e=>{switch(e){case"pdf":return"application/pdf";case"images":return"image/*";case"video":return"video/*";default:return""}};return(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center border-b pb-2 py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("span",{children:"File Upload"}),(0,b.jsx)("button",{title:"Delete File Node",className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold",onClick:()=>n(t),children:"\xd7"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-2 px-2 pb-3",children:[(0,b.jsxs)("div",{className:"mb-2",title:"Message",children:[(0,b.jsx)("input",{type:"text",placeholder:"Message",value:l.data.message,onChange:e=>p("message",e.target.value),onBlur:e=>m("message",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),i.message&&(0,b.jsx)("small",{className:"text-red-500",children:i.message})]}),(0,b.jsxs)("div",{className:"mb-2",title:"File Type",children:[(0,b.jsxs)("select",{value:l.data.fileType,onChange:e=>p("fileType",e.target.value),onBlur:e=>m("fileType",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",children:[(0,b.jsx)("option",{value:"pdf",children:"PDF"}),(0,b.jsx)("option",{value:"images",children:"Images"}),(0,b.jsx)("option",{value:"video",children:"Video"})]}),i.fileType&&(0,b.jsx)("small",{className:"text-red-500",children:i.fileType})]}),(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("label",{children:"Upload File:"}),(0,b.jsx)("input",{disabled:!l.data.fileType||""!==l.data.url,type:"file",accept:c,multiple:!0,onChange:e=>p("files",Array.from(e.target.files||[])),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),i.files&&(0,b.jsx)("small",{className:"text-red-500",children:i.files})]}),(0,b.jsxs)("div",{className:"mb-1",title:"URL",children:[(0,b.jsx)("input",{type:"text",placeholder:"URL",value:l.data.url,onChange:e=>p("url",e.target.value),onBlur:e=>m("url",e.target.value),disabled:l.data.files.length>0,className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),i.url&&(0,b.jsx)("small",{className:"text-red-500",children:i.url})]})]}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"})]})},T=e=>{let{id:t,data:a}=e;const{node:l,onDelete:n,handleChange:o}=a,[i,d]=(0,s.useState)({}),c=(e,t)=>{let a={...l.data,[e]:t},s={};"message"===e&&(t.trim()?t.length<3?s.message="Message must be at least 3 characters":t.length>50&&(s.message="Message must be less than 50 characters"):s.message="Message is required"),"url"===e&&(t.trim()?t&&!h(t)&&(s.url="Invalid URL format"):s.url="URL is required"),d(s),o(l.id,a)};return(0,b.jsxs)("div",{className:"flow-node bg-gray-900 text-white rounded-md shadow-md",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-600 pb-2 mb-2flex justify-between items-center py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("span",{children:"Google Maps"}),(0,b.jsx)("button",{title:"Delete Node",className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px",onClick:()=>n(t),children:"\xd7"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-2 px-2",children:[(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("input",{type:"text",value:l.data.message,onChange:e=>c("message",e.target.value),onBlur:e=>c("message",e.target.value),placeholder:"Message:",className:"w-full p-1 rounded-md border border-gray-600 bg-gray-700 text-white"}),i.message&&(0,b.jsx)("small",{className:"text-red-500",children:i.message})]}),(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("input",{type:"text",value:l.data.url,onChange:e=>c("url",e.target.value),onBlur:e=>c("url",e.target.value),placeholder:"Google Maps URL:",className:"w-full p-1 rounded-md border border-gray-600 bg-gray-700 text-white"}),i.url&&(0,b.jsx)("small",{className:"text-red-500",children:i.url})]})]}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"})]})};var k=a(26629);const O={jpg:"image/*",jpeg:"image/*",png:"image/*",gif:"image/*",mp4:"video/*",avi:"video/*",mov:"video/*",wmv:"video/*",mp3:"audio/*",wav:"audio/*",pdf:"application/pdf"},D=[{id:S(),type:"start",data:{message:"Chat Window Opened"},position:{x:10,y:10}}];function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t="abcdefghijklmnopqrstuvwxyz0123456789";let a="";const s=Date.now().toString(36);for(let l=0;l<e;l++)a+=t.charAt(Math.floor(36*Math.random()));return s+a}const _=e=>{if(e&&e.flows.length>0){let t=A(e);const a=M(e);return t=[...D,...t],{flowNodes:t,flowEdges:a}}return{flowNodes:[...D],flowEdges:[]}},A=e=>e.flows.map(((t,a)=>({id:t.flowId,type:t.type,data:L(t),position:P(t,a,e)}))),L=e=>{const t={};switch(["message","leadForm","gpt","leadFlow","stop","file","map","question","options"].includes(e.type)&&(t.message="string"===typeof e.content?e.content:e.content[0]),e.type){case"options":t.displayText=e.displayText,t.fallback=e.fallback,t.propertyName=e.propertyName,t.subOptions=I(e.children);break;case"file":t.files=e.media?e.media:[],t.fileType=e.media?R(e.media):"",t.url=e.url;break;case"map":t.url=e.url;break;case"question":t.answer=e.answer}return t},I=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>({id:e.flowId||S(),title:e.title,subTitle:e.subTitle,value:e.value,category:e.category,leadEmailTo:e.leadEmailTo?e.leadEmailTo:"",leadEmailCc:e.leadEmailCc?[...e.leadEmailCc]:[],isCollapsed:!1})))},P=(e,t,a)=>{let s={x:t+150,y:t+50};var l;e.flowId&&a.positions&&(s=(null===(l=a.positions.find((t=>t.nodeId===e.flowId)))||void 0===l?void 0:l.position)||s);return s},M=e=>{const t={id:D[0].id,source:D[0].id,target:null===e||void 0===e?void 0:e.startFlowId,type:"custom"};let a=e.flows.filter((e=>e.nextFlowId)).map((e=>({id:`e-${e.flowId}-${e.nextFlowId}`,source:e.flowId,target:e.nextFlowId,type:"custom"})));return a=[t,...a],a},B=e=>O[e.toLowerCase()]||"",R=e=>{const t=new Set;for(const a of e){const e=a.name.split(".").pop();if(e){const a=B(e);a&&t.add(a)}}return Array.from(t).join(", ")},F=e=>{let{optionsData:t,save:a,close:l}=e;t.subOptions.forEach((e=>{e.isCollapsed=!1}));const[r,n]=(0,s.useState)(t),[o,d]=(0,s.useState)({});(0,s.useEffect)((()=>{n(t)}),[t]);const c=e=>{const{name:t,value:a}=e.target;n({...r,[t]:a.trim()})},u=(e,t)=>{const a=g(e,t);d((t=>({...t,[e]:a})))},m=(e,t,a)=>{const s=g(t,a);d((a=>{var l;return{...a,subOptions:{...a.subOptions,[e]:{...null===(l=a.subOptions)||void 0===l?void 0:l[e],[t]:s}}}}))},p=(e,t)=>{const{name:a,value:s}=t.target,l=[...r.subOptions],o={...l[e]};o[a]=s.trim(),l[e]=o,n({...r,subOptions:l})},h=(e,t)=>{const a=r.subOptions.find((t=>t.id===e));a&&(i(t)?a.leadEmailTo.includes(t)?d((t=>{var a;return{...t,subOptions:{...t.subOptions,[e]:{...null===(a=t.subOptions)||void 0===a?void 0:a[e],leadEmailCc:"This email is already in Lead Email To."}}}})):(n({...r,subOptions:r.subOptions.map((a=>a.id===e?{...a,leadEmailCc:[...a.leadEmailCc,t]}:a))}),d((t=>{var a;return{...t,subOptions:{...t.subOptions,[e]:{...null===(a=t.subOptions)||void 0===a?void 0:a[e],leadEmailCc:""}}}}))):d((t=>{var a;return{...t,subOptions:{...t.subOptions,[e]:{...null===(a=t.subOptions)||void 0===a?void 0:a[e],leadEmailCc:"Invalid email address"}}}})))};return(0,b.jsxs)("div",{className:"flow-node fixed inset-0 flex flex-col bg-gray-900 text-white",children:[(0,b.jsx)("div",{className:"fixed top-0 left-0 right-0 bg-gray-800 text-white shadow-md z-10",children:(0,b.jsxs)("div",{className:"modal-header p-4 flex justify-between items-center",children:[(0,b.jsx)("h5",{className:"modal-title text-lg font-bold",children:"Edit Options"}),(0,b.jsx)("button",{type:"button",className:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700",title:"Close popup",onClick:l,children:"\xd7"})]})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 pt-16 pb-20",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 mb-4",children:[(0,b.jsx)("div",{className:"min-w-[200px] px-2 shadow-md",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Display Text"}),(0,b.jsx)("input",{type:"text",maxLength:50,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",name:"displayText",value:r.displayText,onChange:c,onBlur:e=>u("displayText",e.target.value)}),o.displayText&&(0,b.jsx)("small",{className:"text-red-500",children:o.displayText})]})}),(0,b.jsx)("div",{className:"min-w-[200px] px-2 shadow-md",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Property Name"}),(0,b.jsx)("input",{type:"text",maxLength:50,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",name:"propertyName",value:r.propertyName,onChange:c,onBlur:e=>u("propertyName",e.target.value)}),o.propertyName&&(0,b.jsx)("small",{className:"text-red-500",children:o.propertyName})]})}),(0,b.jsx)("div",{className:"min-w-[200px] px-2 shadow-md",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Message"}),(0,b.jsx)("input",{type:"text",maxLength:50,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",name:"message",value:r.message,onChange:c,onBlur:e=>u("message",e.target.value)}),o.message&&(0,b.jsx)("small",{className:"text-red-500",children:o.message})]})}),(0,b.jsx)("div",{className:"min-w-[200px] px-2 shadow-md",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Fall back"}),(0,b.jsx)("input",{type:"text",maxLength:50,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",name:"fallback",value:r.fallback,onChange:c,onBlur:e=>u("fallback",e.target.value)}),o.fallback&&(0,b.jsx)("small",{className:"text-red-500",children:o.fallback})]})})]}),r.subOptions.map(((e,t)=>{var a,s,l,c,u,g,x,f,v,w,y,j,N,C,E,T,k,O;return(0,b.jsxs)("div",{className:"accordion px-2 mb-2",children:[(0,b.jsxs)("div",{className:"accordion-header flex items-center p-1 cursor-pointer border border-gray-600 rounded bg-gray-800 hover:bg-gray-700 transition-colors",onClick:()=>(e=>{const t=r.subOptions.map(((t,a)=>a===e?{...t,isCollapsed:!t.isCollapsed}:t));n({...r,subOptions:t})})(t),children:[(0,b.jsx)("span",{className:"mr-3",children:e.isCollapsed?(0,b.jsx)("svg",{className:"w-5 h-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):(0,b.jsx)("svg",{className:"w-5 h-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})})}),(0,b.jsx)("span",{className:"flex-1",children:e.title||`Sub Option ${t+1}`}),r.subOptions.length>1&&(0,b.jsx)("button",{type:"button",className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold pt-px ml-4",onClick:e=>{e.stopPropagation(),(e=>{n({...r,subOptions:r.subOptions.filter(((t,a)=>a!==e))})})(t)},children:"\xd7"})]}),!e.isCollapsed&&(0,b.jsx)("div",{className:"accordion-content bg-gray-700 p-4 rounded",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:[(0,b.jsx)("div",{className:"min-w-[200px]",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Title"}),(0,b.jsx)("input",{type:"text",maxLength:50,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-800 text-white rounded",name:"title",value:e.title,onChange:e=>p(t,e),onBlur:e=>m(t,"title",e.target.value)}),(null===(a=o.subOptions)||void 0===a||null===(s=a[t])||void 0===s?void 0:s.title)&&(0,b.jsx)("small",{className:"text-red-500",children:null===(l=o.subOptions[t])||void 0===l?void 0:l.title})]})}),(0,b.jsx)("div",{className:"min-w-[200px]",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Sub Title"}),(0,b.jsx)("input",{type:"text",maxLength:50,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-800 text-white rounded",name:"subTitle",value:e.subTitle,onChange:e=>p(t,e),onBlur:e=>m(t,"subTitle",e.target.value)}),(null===(c=o.subOptions)||void 0===c||null===(u=c[t])||void 0===u?void 0:u.subTitle)&&(0,b.jsx)("small",{className:"text-red-500",children:null===(g=o.subOptions[t])||void 0===g?void 0:g.subTitle})]})}),(0,b.jsx)("div",{className:"min-w-[200px",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Value"}),(0,b.jsx)("input",{type:"text",maxLength:500,className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-800 text-white rounded",name:"value",value:e.value,onChange:e=>p(t,e),onBlur:e=>m(t,"value",e.target.value)}),(null===(x=o.subOptions)||void 0===x||null===(f=x[t])||void 0===f?void 0:f.value)&&(0,b.jsx)("small",{className:"text-red-500",children:null===(v=o.subOptions[t])||void 0===v?void 0:v.value})]})}),(0,b.jsx)("div",{className:"min-w-[200px]",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Select Category"}),(0,b.jsxs)("select",{className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-800 text-white rounded",value:e.category,onChange:e=>((e,t)=>{const{value:a}=t.target,s=[...r.subOptions];s[e].category=a,n({...r,subOptions:s})})(t,e),onBlur:e=>m(t,"category",e.target.value),children:[(0,b.jsx)("option",{value:"",children:"Select Category"}),(0,b.jsx)("option",{value:"presale",children:"Presale"}),(0,b.jsx)("option",{value:"general",children:"General"}),(0,b.jsx)("option",{value:"others",children:"Others"})]}),(null===(w=o.subOptions)||void 0===w||null===(y=w[t])||void 0===y?void 0:y.category)&&(0,b.jsx)("small",{className:"text-red-500",children:null===(j=o.subOptions[t])||void 0===j?void 0:j.category})]})}),(0,b.jsx)("div",{className:"min-w-[200px]",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"input-label",children:"Lead Email To"}),(0,b.jsx)("input",{autoComplete:"off",maxLength:254,type:"text",className:"form-control form-control-sm w-full p-1 border border-gray-600 bg-gray-800 text-white rounded",name:"leadEmailTo",value:e.leadEmailTo,onChange:e=>p(t,e),onBlur:e=>m(t,"leadEmailTo",e.target.value)}),(null===(N=o.subOptions)||void 0===N||null===(C=N[t])||void 0===C?void 0:C.leadEmailTo)&&(0,b.jsx)("small",{className:"text-red-500",children:null===(E=o.subOptions[t])||void 0===E?void 0:E.leadEmailTo})]})}),(0,b.jsx)("div",{className:"min-w-[200px]",children:(0,b.jsxs)("div",{className:"form-group",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead Email Cc"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center border border-gray-600 rounded bg-gray-800",children:[e.leadEmailCc.map((t=>(0,b.jsxs)("div",{className:"flex items-center bg-blue-100 text-blue-800 text-sm rounded-full mr-2 mb-2 px-3 py-1",children:[t,(0,b.jsx)("button",{type:"button",onClick:()=>{return a=e.id,s=t,void n({...r,subOptions:r.subOptions.map((e=>e.id===a?{...e,leadEmailCc:e.leadEmailCc.filter((e=>e!==s))}:e))});var a,s},className:"ml-2 text-red-500 hover:text-red-700 focus:outline-none",children:"\xd7"})]},t))),(0,b.jsx)("input",{autoComplete:"off",placeholder:"Type or paste email addresses and press `Enter`",type:"text",className:"flex-grow p-1 border-none text-sm border-gray-600 bg-gray-800 text-white rounded",name:"leadEmailCc",onBlur:e=>m(t,"leadEmailCc",e.target.value),onKeyDown:e=>((e,t)=>{if(["Enter","Tab",","].includes(t.key)){t.preventDefault();const a=t.currentTarget.value.trim();a&&(h(r.subOptions[e].id,a),t.currentTarget.value="")}})(t,e),onPaste:t=>((e,t)=>{t.preventDefault();const a=t.clipboardData.getData("text").split(/[ ,;]/).map((e=>e.trim())).filter((e=>""!==e)),s=r.subOptions.find((t=>t.id===e));if(!s)return;if(a.filter((e=>!i(e))).length>0)return void d((t=>{var a;return{...t,subOptions:{...t.subOptions,[e]:{...null===(a=t.subOptions)||void 0===a?void 0:a[e],leadEmailCc:"Invalid email address"}}}}));a.filter((e=>s.leadEmailTo.includes(e))).length>0?d((t=>{var a;return{...t,subOptions:{...t.subOptions,[e]:{...null===(a=t.subOptions)||void 0===a?void 0:a[e],leadEmailCc:"Some emails are already in Lead Email To"}}}})):(n({...r,subOptions:r.subOptions.map((t=>t.id===e?{...t,leadEmailCc:[...t.leadEmailCc,...a]}:t))}),d((t=>{var a;return{...t,subOptions:{...t.subOptions,[e]:{...null===(a=t.subOptions)||void 0===a?void 0:a[e],leadEmailCc:""}}}})))})(e.id,t)})]}),(null===(T=o.subOptions)||void 0===T||null===(k=T[t])||void 0===k?void 0:k.leadEmailCc)&&(0,b.jsx)("small",{className:"text-red-500",children:null===(O=o.subOptions[t])||void 0===O?void 0:O.leadEmailCc})]})})]})})]},t)})),(0,b.jsxs)("button",{className:"flex ml-2 px-2 py-1 font-semibold text-white btn-primary-custom rounded items-center",onClick:()=>{n({...r,subOptions:[...r.subOptions,{id:S(),title:"",subTitle:"",value:"",category:"",leadEmailTo:"",leadEmailCc:[]}]})},children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-white font-semibold cursor-pointer hover:text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Add"]})]}),(0,b.jsx)("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-800 text-white shadow-md",children:(0,b.jsxs)("div",{className:"modal-footer py-2 px-4 flex justify-between",children:[(0,b.jsxs)("button",{type:"button",className:"flex items-center justify-center rounded btn px-2 py-2 btn-secondary bg-gray-600 hover:bg-gray-700",onClick:l,children:[(0,b.jsx)("svg",{className:"w-6 h-6 text-white cursor-pointer hover:text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}),"Close"]}),(0,b.jsxs)("button",{type:"button",className:"flex items-center justify-center px-4 py-2 font-semibold text-white btn-primary-custom rounded ",onClick:()=>{r.subOptions.forEach((e=>{e.isCollapsed=!0})),a(r),l()},children:[(0,b.jsx)("svg",{className:"w-6 h-6 text-white cursor-pointer hover:text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 21H7a2 2 0 01-2-2V5a2 2 0 012-2h10a2 2 0 012 2v14a2 2 0 01-2 2zM7 3v4a1 1 0 001 1h8a1 1 0 001-1V3M7 10h10v11H7V10z"})}),"Save changes"]})]})})]})},$=e=>{let{subOption:t,index:a,onDelete:s,expandToEdit:l,length:n}=e;return(0,b.jsxs)("div",{className:"bg-gray-700 text-white rounded-md p-1 mt-2",style:{width:"100%",padding:"4px 10px",border:"1px solid grey",borderRadius:"6px",margin:"10px 0",position:"relative"},children:[(0,b.jsxs)("div",{className:"flex justify-between items-center cursor-pointer grow",children:[(0,b.jsx)("div",{className:"flex justify-between items-center grow min-w-0",children:(0,b.jsxs)("div",{className:"flex min-w-0",children:[(0,b.jsxs)("svg",{onClick:l,className:"min-w-4 w-4 h-4 mr-2 text-blue-300 cursor-pointer hover:text-white",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg",children:[(0,b.jsx)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,b.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]}),(0,b.jsx)("strong",{className:"text-sm grow text-ellipsis overflow-hidden whitespace-nowrap min-w-0",children:t.title?`${a+1}. ${t.title}`:`${a+1}. Sub Option`})]})}),n>1&&(0,b.jsx)("button",{type:"button",className:"text-white bg-red-500 hover:bg-red-700 rounded-full min-w-4 h-4 w-4 text-xs flex items-center justify-center ml-2",onClick:e=>{e.stopPropagation(),s(a)},children:"\xd7"})]}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Right,id:t.id})]})},H=e=>{let{data:t,id:a}=e;const{node:l,onDelete:n,handleChange:o}=t,[i,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!1),[m,p]=(0,s.useState)({}),[h,x]=(0,s.useState)(l.data),f=(e,t)=>{const a=g(e,t);p((t=>({...t,[e]:a})))},v=(e,t)=>{const a={...h,[e]:t};x(a),o(l.id,a)},w=e=>{const t=h.subOptions.filter(((t,a)=>a!==e)),a={...h,subOptions:t};x(a),o(l.id,a)},y=()=>d(!1),j=()=>d(!0);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-md ",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("strong",{className:"cursor-pointer mr-3",onClick:()=>u(!c),children:"Option"}),(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("button",{className:"text-gray-400 hover:text-white mr-3",title:"Expand",onClick:()=>d((e=>!e)),children:(0,b.jsx)("svg",{className:"w-4 h-4 text-blue-500 cursor-pointer hover:text-blue-700",fill:"white",stroke:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 242.133 242.133",children:(0,b.jsx)("path",{id:"XMLID_15_",d:"M227.133,83.033c8.283,0,15-6.716,15-15V15c0-8.284-6.717-15-15-15H174.1c-8.284,0-15,6.716-15,15 s6.716,15,15,15h16.82l-69.854,69.854L51.213,30h16.82c8.284,0,15-6.716,15-15s-6.716-15-15-15H15C6.717,0,0,6.716,0,15v53.033 c0,8.284,6.717,15,15,15c8.285,0,15-6.716,15-15v-16.82l69.854,69.854L30,190.92V174.1c0-8.284-6.715-15-15-15 c-8.283,0-15,6.716-15,15v53.033c0,8.284,6.717,15,15,15h53.033c8.284,0,15-6.716,15-15c0-8.284-6.716-15-15-15h-16.82 l69.854-69.854l69.854,69.854H174.1c-8.284,0-15,6.716-15,15c0,8.284,6.716,15,15,15h53.033c8.283,0,15-6.716,15-15V174.1 c0-8.284-6.717-15-15-15c-8.285,0-15,6.716-15,15v16.82l-69.854-69.854l69.854-69.854v16.82 C212.133,76.317,218.848,83.033,227.133,83.033z"})})}),(0,b.jsx)("button",{title:"Delete Node",className:"text-white text-xl font-semibold bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center",onClick:()=>n(a),children:"\xd7"})]})]}),!c&&(0,b.jsxs)("div",{className:"space-y-4 py-2 px-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"text",maxLength:50,placeholder:"Display Text",value:h.displayText,onChange:e=>v("displayText",e.target.value),onBlur:e=>f("displayText",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),m.displayText&&(0,b.jsx)("small",{className:"text-red-500",children:m.displayText})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"text",maxLength:50,placeholder:"Property Name",value:h.propertyName,onChange:e=>v("propertyName",e.target.value),onBlur:e=>f("propertyName",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),m.propertyName&&(0,b.jsx)("small",{className:"text-red-500",children:m.propertyName})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"text",maxLength:50,value:h.message,placeholder:"Message",onChange:e=>v("message",e.target.value),onBlur:e=>f("message",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),m.message&&(0,b.jsx)("small",{className:"text-red-500",children:m.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("input",{type:"text",maxLength:50,value:h.fallback,placeholder:"Fall back",onChange:e=>v("fallback",e.target.value),onBlur:e=>f("fallback",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded"}),m.fallback&&(0,b.jsx)("small",{className:"text-red-500",children:m.fallback})]}),h.subOptions.map(((e,t)=>(0,b.jsx)($,{subOption:e,index:t,onDelete:w,length:h.subOptions.length,expandToEdit:j},t))),(0,b.jsxs)("button",{className:"flex px-2 py-1 font-semibold text-white btn-primary-custom rounded items-center",onClick:()=>{const e={id:S(),title:"",subTitle:"",value:"",category:"",leadEmailTo:"",leadEmailCc:[],isCollapsed:!0},t={...h,subOptions:[...h.subOptions,e]};x(t),o(l.id,t),d(!0)},children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-white font-semibold cursor-pointer hover:text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Add"]})]}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,id:a})]}),(0,b.jsx)(k.A,{open:i,closeOnDocumentClick:!0,onClose:y,children:(0,b.jsx)(F,{save:e=>{const t={...e,subOptions:e.subOptions.map((e=>({...e,isCollapsed:!0})))};x(t),o(l.id,t)},optionsData:h,close:y})})]})};var U=a(18517),V=a(28535);a(73907);const W=[{message:"Can you provide me your contact number",type:"phone"},{message:"May I know your age",type:"number"},{message:"When would you like to travel",type:"date"},{message:"May I know which city you would like to visit",type:"text"}],X=e=>{let{id:t,data:a}=e;const{node:l,onDelete:n,handleChange:o}=a,[i,d]=(0,s.useState)({}),c=new Date((new Date).setHours(0,0,0)),u=W.find((e=>e.message===l.data.message)),m=(e,t)=>{let a="";if(t){if(u)switch(u.message){case"Can you provide me your contact number":const e=t.trim().toString();(e.length<6||e.length>13)&&(a="Enter a valid phone number.");break;case"May I know your age":const s=parseInt(t.trim(),10);(isNaN(s)||s<18||s>99)&&(a="Enter a valid age between 18 and 99.");break;case"When would you like to travel":const l=new Date(new Date(t).setHours(0,0,0,0)),r=new Date((new Date).setHours(0,0,0,0)),n=new Date(r);n.setMonth(r.getMonth()+3),(isNaN(l.getTime())||l<r||l>n)&&(a="Enter a valid date between today and the next 3 months.");break;case"May I know which city you would like to visit":(t.trim().length<3||t.trim().length>50)&&(a="Enter a city name between 3 and 50 characters.")}}else a="This field is required.";d((t=>({...t,[e]:a})))},p=(e,t)=>{d({});const a={...l.data,[e]:t};o(l.id,a)};return(0,b.jsx)(V.mD,{children:(0,b.jsxs)("div",{className:"flow-node bg-gray-800 text-white rounded-md shadow-lg",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center border-b pb-2 py-2 px-2 border-b-4 border-indigo-500",children:[(0,b.jsx)("span",{children:"Question Node"}),(0,b.jsx)("button",{title:"Delete Question Node",className:"text-white bg-red-500 hover:bg-red-700 rounded-full h-6 w-6 flex items-center justify-center text-xl font-extrabold",onClick:()=>n(t),children:"\xd7"})]}),(0,b.jsxs)("div",{className:"space-y-4 py-2 px-2 pb-3",children:[(0,b.jsxs)("div",{className:"mb-2",title:"Question",children:[(0,b.jsxs)("select",{value:l.data.message||"",onChange:e=>{const t=W.find((t=>t.message===e.target.value)),a={...l.data,message:e.target.value,answer:""};o(l.id,a),d((e=>({...e,message:t?"":"Selection is required."})))},className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",children:[(0,b.jsx)("option",{value:"",children:"Select Question"}),W.map((e=>(0,b.jsx)("option",{value:e.message,children:e.message},e.message)))]}),i.message&&(0,b.jsx)("small",{className:"text-red-500",children:i.message})]}),(0,b.jsxs)("div",{className:"mb-2",title:"Answer",children:["phone"===(null===u||void 0===u?void 0:u.type)&&(0,b.jsx)("input",{type:"text",placeholder:"Your Contact Number",value:l.data.answer,onChange:e=>p("answer",e.target.value),onBlur:e=>m("answer",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",maxLength:13}),"number"===(null===u||void 0===u?void 0:u.type)&&(0,b.jsx)("input",{type:"number",placeholder:"Your Age",value:l.data.answer,onChange:e=>p("answer",e.target.value),onBlur:e=>m("answer",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",min:18,max:99}),"date"===(null===u||void 0===u?void 0:u.type)&&(0,b.jsx)(U.V,{placeholder:"Select a Date",value:l.data.answer||"",onChange:e=>p("answer",e.value),onBlur:e=>m("answer",e.target.value),minDate:c,maxDate:new Date((new Date).setMonth((new Date).getMonth()+3)),className:"w-full px-1 border border-gray-600 bg-gray-700 text-white rounded"},"date"),"text"===(null===u||void 0===u?void 0:u.type)&&(0,b.jsx)("input",{type:"text",placeholder:"Enter the city you'd like to visit",value:l.data.answer,onChange:e=>p("answer",e.target.value),onBlur:e=>m("answer",e.target.value),className:"w-full p-1 border border-gray-600 bg-gray-700 text-white rounded",minLength:3,maxLength:50}),i.answer&&(0,b.jsx)("small",{className:"text-red-500",children:i.answer})]})]}),(0,b.jsx)(r.h7,{type:"target",position:r.yX.Top,className:"w-2 h-2 bg-white border-none"}),(0,b.jsx)(r.h7,{type:"source",position:r.yX.Bottom,className:"w-2 h-2 bg-white border-none"})]})})};const q=e=>{let{flowList:t,value:a,onChange:s}=e;return(0,b.jsxs)("div",{className:"pb-3",children:[(0,b.jsx)("label",{htmlFor:"dropdown",className:"text-xs",children:"Flows"}),(0,b.jsxs)("select",{id:"dropdown",className:"border w-full","aria-label":"Select Draft or Version to View and Modify",onChange:e=>s(e.target.value),value:a||"",children:[(0,b.jsx)("option",{value:"",children:"Select a flow"}),null===t||void 0===t?void 0:t.map((e=>(0,b.jsx)("option",{value:e.value,children:e.label},e.value)))]})]})},K=e=>{let{onDragStart:t,clearFlow:a,onSave:s,errors:l,nodes:r,edges:n,flowList:o,onFlowSelectionChange:i,onDelete:d,flowId:c,flowData:u}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flow-tools",children:[(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"message"),draggable:!0,children:"Message"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"options"),draggable:!0,children:"Options"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"leadForm"),draggable:!0,children:"Lead Form"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"gpt"),draggable:!0,children:"GPT Handler"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"file"),draggable:!0,children:"File"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"map"),draggable:!0,children:"Maps"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"question"),draggable:!0,children:"Question"}),(0,b.jsx)("button",{className:"button",onDragStart:e=>t(e,"stop"),draggable:!0,children:"Stop"})]}),(0,b.jsxs)("div",{className:"flow-actions",children:[(0,b.jsx)(q,{flowList:o,onChange:i,value:c}),(0,b.jsx)("button",{disabled:Object.keys(l).length>0||r.length<2||n.length<1,className:"px-2 py-2 font-semibold text-white btn-primary-custom rounded items-center text-center",onClick:()=>s(),children:"Save"}),(0,b.jsx)("button",{disabled:Object.keys(l).length>0||r.length<2||n.length<1||!(null===u||void 0===u||!u.deployedAt),className:"px-2 py-2 font-semibold text-white btn-primary-custom rounded items-center text-center",onClick:()=>s(!0),children:"Deploy"}),(0,b.jsx)("button",{disabled:r.length<2,title:"Clear Board - Will delete all Nodes and Edges",className:"text-white bg-red-500 hover:bg-red-700 rounded h-8 w-8 flex items-center justify-center",onClick:()=>a(),children:"Clear"}),(0,b.jsx)("button",{disabled:!c,title:"Clear Board - Will delete all Nodes and Edges",className:"text-white bg-red-500 hover:bg-red-700 rounded h-8 w-8 flex items-center justify-center hidden",onClick:()=>d(c),children:"Delete"})]})]})},z=s.memo(K),G={start:C,message:v,options:H,leadForm:w,leadFlow:y,gpt:j,stop:N,file:E,map:T,question:X},Y={custom:function(e){let{id:t,sourceX:a,sourceY:s,targetX:l,targetY:n,sourcePosition:o,targetPosition:i,style:d={},markerEnd:c}=e;const{setEdges:u}=(0,r.VH)(),[m,p,h]=(0,r.oN)({sourceX:a,sourceY:s,sourcePosition:o,targetX:l,targetY:n,targetPosition:i});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{style:{position:"absolute"},children:(0,b.jsx)("defs",{children:(0,b.jsx)("marker",{id:"arrowhead",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto",children:(0,b.jsx)("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#ff0073"})})})}),(0,b.jsx)(r.tE,{path:m,markerEnd:"url(#arrowhead)",style:d}),(0,b.jsx)(r.rV,{children:(0,b.jsx)("div",{style:{position:"absolute",transform:`translate(-50%, -50%) translate(${p}px,${h}px)`,fontSize:12,pointerEvents:"all"},className:"nodrag nopan",children:(0,b.jsx)("button",{className:"w-6 h-6 bg-gray-300 border border-gray-500 rounded-full text-base font-bold text-gray-800 flex items-baseline justify-center hover:bg-red-600 hover:border-red-700 hover:text-white hover:shadow-md",onClick:()=>{u((e=>e.filter((e=>e.id!==t))))},children:"\xd7"})})})]})}},J=e=>{let{flowData:t,flowList:a,onSave:l,onVersionSelected:i,onDelete:p}=e;const[h,g]=(0,s.useState)([]),[v,w]=(0,s.useState)([]),[y,j]=(0,s.useState)({}),N=()=>{j({})};(0,s.useEffect)((()=>{const{flowNodes:e,flowEdges:a}=_(t);g(e),w(a)}),[t]);const C=(0,s.useCallback)((e=>{N(),g((t=>(0,r._0)(e,t)))}),[]),E=(0,s.useCallback)((e=>{N(),w((t=>(0,r.zW)(e,t)))}),[]),T=(0,s.useCallback)((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),k=(0,s.useCallback)((e=>{N(),e.preventDefault();const t=(e=>{const t=e.currentTarget.getBoundingClientRect(),a=e.dataTransfer.getData("application/reactflow"),s={x:e.clientX-t.left,y:e.clientY-t.top};return{id:S(),type:a,position:s,data:{message:""},..."options"===a&&{data:{displayText:"",propertyName:"",message:"",fallback:"",subOptions:[{id:S(),title:"",subTitle:"",value:"",leadEmailTo:"",leadEmailCc:[],category:"",isCollapsed:!0}]}},..."file"===a&&{data:{message:"",fileType:"pdf",url:"",files:[]}},..."map"===a&&{data:{message:"",url:""}},..."leadForm"===a&&{data:{message:"This will display lead form for the visitor"}},..."gpt"===a&&{data:{message:"From here on visitors would be handled by GPT"}},..."question"===a&&{data:{message:"",answer:""}}}})(e);g((e=>e.concat(t)))}),[]),O=e=>{N(),g((t=>t.filter((t=>t.id!==e)))),w((t=>t.filter((t=>t.source!==e&&t.target!==e))))},D=(0,s.useCallback)((e=>{N(),w(e.reduce(((e,t)=>{const a=(0,r.FB)(t,h,v),s=(0,r.RM)(t,h,v),l=(0,r.AX)([t],v);return[...e.filter((e=>!l.includes(e))),...a.flatMap((e=>{let{id:t}=e;return s.map((e=>{let{id:a}=e;return{id:`${t}->${a}`,source:t,target:a}}))}))]}),v))}),[h,v]),A=e=>{if(h.length<2){const e={MinNodes:"Minimum 2 nodes required for a valid flow"};return j(e),!1}let a={};for(const t of h)if("message"===t.type){const e=d(t.data);a={...a,...e}}else if("option"===t.type){const e=c(t.data);a={...a,...e}}else if("file"===t.type){const e=u(t.data);a={...a,...e}}else if("map"===t.type){const e=m(t.data);a={...a,...e}}else if("question"===t.type){const e=x(t.data);a={...a,...e}}if(Object.keys(a).length>0)return void j(a);const s={nodes:h,edges:v},r=(e=>e.map((e=>{let{id:t,type:a,data:s,position:l}=e;return s.subOptions&&(s.subOptions=s.subOptions.map((e=>{const{isCollapsed:t,...a}=e;return a}))),{id:t,type:a,data:s,position:l}})))(h);s.nodes=r;const n=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=e.slice(1);let l=[];const r=e.find((e=>"start"===e.type)),n=t.find((e=>e.source===(null===r||void 0===r?void 0:r.id))),o=n?n.target:"",i=s.map((a=>{const s=t.find((e=>e.source===a.id)),r=s?s.target:null,n={flowId:a.id,nextFlowId:r||"",type:a.type,content:""};return a.data.message&&(n.content=a.data.message),"file"===a.type&&a.data.files&&(n.media=a.data.files.map((e=>({name:e.name||"Unnamed file",url:e.url||""}))),n.url=a.data.url),"map"===a.type&&a.data.url&&(n.url=a.data.url),"question"===a.type&&(n.answer=a.data.answer),a.data.subOptions&&(n.children=a.data.subOptions.map((e=>{const s=t.find((t=>t.source===a.id&&t.sourceHandle===e.flowId));return{title:e.title,subTitle:e.subTitle,value:e.value,category:e.category,leadEmailTo:e.leadEmailTo,leadEmailCc:e.leadEmailCc?[...e.leadEmailCc]:[],nextFlowId:s?s.target:void 0}}))),a.data.propertyName&&(n.propertyName=a.data.propertyName),a.data.displayText&&(n.displayText=a.data.displayText),a.data.fallback&&(n.fallback=a.data.fallback),l=e.map((e=>({nodeId:e.id,position:e.position}))),n}));return{_id:a._id?a._id:"",organizationId:a.organizationId?a.organizationId:"",botId:(a.botId,a.botId),createdAt:(new Date).toISOString(),version:0,startFlowId:o,flows:i,__v:0,deployedAt:(new Date).toISOString(),modifiedAt:(new Date).toISOString(),positions:l}}(r,v,t);l(n,e)};return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"flow-diagram",children:[(0,b.jsx)("div",{className:"reactflow-wrapper",children:(0,b.jsxs)("div",{className:"flex flex-col h-full",children:[(0,b.jsx)("div",{className:"reactflow-box",onDrop:k,onDragOver:T,children:(0,b.jsx)(r.Ln,{children:(0,b.jsxs)(r.Gc,{nodes:h.map((e=>({...e,data:{node:e,nodes:h,handleChange:(e,t)=>((e,t)=>{N();const a=h.map((a=>a.id===e?{...a,data:{...a.data,...t}}:a));g(a)})(e,t),onDelete:O}}))),edges:v,onNodesChange:C,onEdgesChange:E,onConnect:e=>{N(),w((t=>(0,r.rN)({...e,type:"custom"},t)))},nodeTypes:G,edgeTypes:Y,onNodesDelete:D,children:[(0,b.jsx)(n.H,{}),(0,b.jsx)(o.V,{})]})})}),Object.keys(y).length>0&&(0,b.jsx)("div",{className:"bg-white p-2 pr-4 text-red-500 text-xs relative",children:(0,b.jsx)(f,{messages:y})})]})}),(0,b.jsx)("div",{className:"toolbar",children:(0,b.jsx)(z,{onDragStart:(e,t)=>{e.dataTransfer.setData("application/reactflow",t)},clearFlow:()=>{let{flowNodes:e}=_();g([e[0]]),w([])},onSave:e=>A(e),errors:y,nodes:h,edges:v,flowList:a,onFlowSelectionChange:i,flowId:null===t||void 0===t?void 0:t._id,onDelete:()=>{p(t)},flowData:t})})]})})};function Q(){const[e,t]=s.useState(null),[a,r]=s.useState(),[n,o]=s.useState(""),i=s.useRef({flow:a});i.current.flow=a;const d=s.useCallback((()=>{(0,l.Ek)().then((e=>{var a;t(e),o((null===(a=e[0])||void 0===a?void 0:a.value)||"")}))}),[]);s.useEffect(d,[d]),s.useEffect((()=>{var e;n&&(null===(e=i.current.flow)||void 0===e?void 0:e._id)!==n&&(0,l.EO)(n).then(r)}),[n]);const c=s.useCallback((async(e,t)=>{const a=await(0,l.EZ)(e.organizationId,e.botId,e,!0===t);o(a._id),r(a),d()}),[d]),u=s.useCallback((async e=>{await(0,l.C7)(e.organizationId,e.botId,e._id)&&(t(null),o(""),d())}),[d]);return(0,b.jsx)(J,{flowData:a,flowList:e,onSave:c,onVersionSelected:o,onDelete:u})}},8478:(e,t,a)=>{a.d(t,{Jt:()=>r,TF:()=>i,bE:()=>n,yJ:()=>o});var s=a(32026),l=a(44364);async function r(e,t){return d("GET",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function n(e,t){return d("POST",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function o(e,t){return d("PUT",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function i(e,t){return d("DELETE",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function d(e,t,a){let{headers:s,noAuth:l,...r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const n="POST"===e||"PUT"===e||"DELETE"===e;t=function(e,t){if(!e)return e;const a=t&&Object.keys(t);if(null!==a&&void 0!==a&&a.length){const s=a.reduce(((e,a)=>{let s=t[a];return null===s||void 0===s?e:(s=`${a}=${encodeURIComponent(s)}`,e?`${e}&${s}`:s)}),"");s&&(e=`${e}${e.includes("?")?"&":"?"}${s}`)}if(e.startsWith("https://"))return e;return`${c}${e}`}(t,n?void 0:a);const o=a instanceof FormData;if(o||(a=a&&"object"===typeof a&&n?JSON.stringify(a):void 0),s||(s={}),o||(s["Content-Type"]="application/json"),s.Accept="application/json",!1!==l){const e=sessionStorage.getItem("token");e&&(s.Authorization=`Bearer ${e}`)}try{const l=await fetch(t,{...r,headers:s,body:a,method:e}),n=await l.json();if(l.ok){const{data:e,...t}=n;return delete t.status,e&&!Object.keys(t).length?e:n}throw n.message?new Error(n.message):n}catch(d){var i;throw console.error("Error calling API: ",d),null!==(i=d.message)&&void 0!==i&&i.includes("fetch")?new Error("Unable to reach server. Please check your network connectivity and try again."):new Error(d.message)}}const c=(0,s.s8)(l.jn,"/")},28564:(e,t,a)=>{a.d(t,{C7:()=>i,CC:()=>c,EO:()=>r,EZ:()=>o,Ek:()=>d,Gl:()=>n});var s=a(33340),l=a(8478);async function r(e){const{selectedBotId:t,organizationId:a}=s.nc.getState();return await n(a,t,e)}async function n(e,t,a){return await l.Jt(`/bot/${e}/${t}/chat-flow/${a}`)}async function o(e,t,a){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=s.nc.getState();e||(e=n.organizationId),t||(t=n.selectedBotId);const o=`/bot/${e}/${t}/chat-flow${r?"?deploy=true":""}`;return await l.bE(o,a)}async function i(e,t,a){return await l.TF(`/bot/${e}/${t}/chat-flow/${a}`)}async function d(){const{selectedBotId:e,organizationId:t}=s.nc.getState();return(await l.Jt(`/bot/${t}/${e}/chat-flow`)).map(c)}function c(e){return{value:e._id,label:`v${e.version} - ${e.deployedAt?"Deployed":"Draft"}`}}},32026:(e,t,a)=>{function s(e,t){return e.replace(new RegExp(`${l(t)}+$`),"")}function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function r(e){const t=new Date(e),a=t.getDate();return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${a}, ${t.getFullYear()}`}function n(e,t,a){if(!t&&!e)return a;e=e||{};const s=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const l=t.indexOf("."),r=t.substring(0,l),o=t.substring(l+1);s[r]=n(e[r],o,a)}else s[t]=a;return s}function o(e,t){return btoa(`${e}_${t}_whatsapp_int`)}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t="abcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let s=0;s<e;s++)a+=t.charAt(Math.floor(36*Math.random()));return a}function d(e,t,a){if(!t&&!e)return a;e=e||{};const s=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const l=t.indexOf("."),r=t.substring(0,l),n=t.substring(l+1);s[r]=d(e[r],n,a)}else s[t]=a;return s}function c(e,t){const a=new Blob([e],{type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/csv"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)}a.d(t,{G6:()=>n,OX:()=>i,PE:()=>c,Yq:()=>r,do:()=>d,qW:()=>o,s8:()=>s})},44364:(e,t,a)=>{a.d(t,{DX:()=>i,Og:()=>r,jn:()=>s,mB:()=>o,pA:()=>n,pR:()=>l});const s="https://devbackend.livhousing.com:444",l="c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",r={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.TRAINING_MEDIA_MAXSIZE,n={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.CONVERSATION_MEDIA_MAXSIZE,o={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.GOOGLE_MAPS_API_KEY,i={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.REACT_APP_NGROK_BACKEND_URL||"https://devbackend.livhousing.com:444"}}]);