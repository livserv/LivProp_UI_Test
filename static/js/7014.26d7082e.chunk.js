"use strict";(self.webpackChunklib_prop_ui=self.webpackChunklib_prop_ui||[]).push([[7014],{47014:(t,e,n)=>{n.d(e,{A:()=>h});var o=n(9950),r=n(17119),s=n(15820),i=n(4709),a=n(8478),l=n(28891),c=n(78023),d=(n(13938),n(44414));const u={window:{spacingCorner:"0px",spacingBottom:"7px"},launcher:{spacingCorner:"0px",spacingBottom:"7px"}},g=["lead","options","stop"];const h=function(t){var e,n;const{botDetails:r,botDesign:l,startupFlow:h,onReceiveChatResponse:v,autoLaunch:b,recipientId:x,origin:S,onCallback:k,optionsRenderer:_}=t,[j,L]=o.useState(b||!1),[U,B]=o.useState(l),[R,F]=o.useState(!1),[H,A]=o.useState(r),[D,N]=o.useState(h),[T,M]=o.useState(null===h||void 0===h?void 0:h.messages),[E,$]=o.useState(x),[q,z]=o.useState([]),[O,P]=o.useState(),J=o.useRef({autoLaunch:b});J.current.recipientId=E,J.current.bot=H,J.current.chatFlowId=null===D||void 0===D?void 0:D.flowId,J.current.startupMessages=T,J.current.origin=S,J.current.setAndBroadcastHistory=o.useCallback((t=>{var e;"function"===typeof t?z((e=>{var n;const o=t(e);return w(o,J.current.origin,null===(n=J.current.bot)||void 0===n?void 0:n._id,!0),o})):(z(t),w(t,J.current.origin,null===(e=J.current.bot)||void 0===e?void 0:e._id,!0))}),[]),J.current.onCallback=o.useCallback(((t,e)=>{"set-visitor-id"===t&&e.recipientId&&$(e.recipientId),null===k||void 0===k||k(t,e)}),[k]),J.current.history=q,J.current.showBot=j,J.current.design=U,J.current.locationDetails=O,J.current.onReceiveChatResponse=v,J.current.isLoadedInConsole=!!v,o.useEffect((()=>{A(r)}),[r]),o.useEffect((()=>{var t;const{updateContact:e,bot:n}=J.current;N(h),null!==h&&void 0!==h&&null!==(t=h.messages)&&void 0!==t&&t.length?M(y([...h.messages],{updateContact:e,botSettings:n.botSettings})):M(!1)}),[h]),o.useEffect((()=>{if(H&&!J.current.isLoadedInConsole)return function(t){t.origin||(t.origin=null);t.botId||(t.botId=null);try{const{origin:e,botId:n}=t;return m=new BroadcastChannel("lp_web_chat"),m.addEventListener("message",C(t)),m.postMessage({action:"GetConversationId",origin:e,botId:n}),()=>{m&&(m.removeEventListener("message",C),m.close(),m=null)}}catch(e){console.error("Unable to start session sharing:",e)}}({botId:H._id,origin:J.current.origin,onHistoryChange:t=>{var e;(null!==t&&void 0!==t&&t.length||null!==(e=J.current.history)&&void 0!==e&&e.length)&&z(t)},getHistory:()=>J.current.history})}),[H]),o.useEffect((()=>{B(l)}),[l]),o.useEffect((()=>{const{updateContact:t,bot:e,recipientId:n,autoLaunch:o,setAndBroadcastHistory:r,startupMessages:s}=J.current;e?f(e,n,t,{autoLaunch:o,startupMessages:y(s,{updateContact:t,botSettings:e.botSettings})}).then(r):async function(t){try{const e=new URLSearchParams(window.location.search),n={authToken:e.get("token"),recipientId:t},{startupFlow:o,...r}=await a.Jt("/bot/get-bot-details-by-auth-token",n,{noAuth:!0});return{startupFlow:o,bot:r}}catch(e){console.log("Failed to init chat:-",e)}}(n).then((e=>{let{bot:s,startupFlow:i}=e;A(s),N(i);const a=y(null===i||void 0===i?void 0:i.messages,{updateContact:t,botSettings:s.botSettings});M(a);const{design:l,isLoadedInConsole:d}=J.current;!l&&s.botDesign&&B((0,c.Y)(s.botDesign,d?void 0:u)),f(s,n,t,{autoLaunch:o,startupMessages:y(a,{updateContact:t,botSettings:s.botSettings})}).then(r)})),i.a().then(P)}),[]);const W=o.useCallback(((t,e)=>{var n,o,r,s;let{showBot:i,design:a,onCallback:l}=J.current;i=t?!i:i,null===l||void 0===l||l("windowToggle",{state:i,design:i?{width:null===a||void 0===a||null===(n=a.window)||void 0===n?void 0:n.width,height:null===a||void 0===a||null===(o=a.window)||void 0===o?void 0:o.height,spacingBottom:null===a||void 0===a||null===(r=a.window)||void 0===r?void 0:r.spacingBottom,spacingCorner:null===a||void 0===a||null===(s=a.window)||void 0===s?void 0:s.spacingCorner}:e})}),[]),G=o.useCallback((async t=>{var e;null!==(e=J.current.history)&&void 0!==e&&e.length||setTimeout((()=>{var t;if(null!==(t=J.current.startupMessages)&&void 0!==t&&t.length)return void J.current.setAndBroadcastHistory((t=>t.concat(...J.current.startupMessages)));const e={role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"};J.current.setAndBroadcastHistory((t=>t?t.concat(e):[e]))}),t||1700)}),[]),Q=o.useCallback((()=>{W(!0),L((t=>!t)),F(!0),setTimeout((()=>F(!1)),1e3),G()}),[W,G]);o.useLayoutEffect((()=>{U&&W(!1,!0)}),[U,W]);const Y=o.useCallback((async t=>function(t,e){var n;const{updateContact:o,onReceiveChatResponse:r,bot:s,locationDetails:l,onCallback:c,recipientId:d,history:u,chatFlowId:g}=e,{flowId:h,flowType:p}=(null===u||void 0===u||null===(n=u[u.length-1])||void 0===n?void 0:n.media)||{};"string"===typeof t&&h&&(t={method:"flow-response",type:p,flowId:h,answer:t});return async function(t,e,n,o){let{onReceiveChatResponse:r,updateContact:s,onCallback:l,recipientId:c,chatFlowId:d}=n;const u=i.Db(),{_id:g,organizationId:h,botSettings:p}=e,v={userQuery:t,recipientDetails:{recipientId:c,conversationId:u,...o},chatFlowId:d};r&&(v.testMode=!0);try{const t=await a.bE(`/bot/${h}/${g}/chat`,v,{noAuth:!0});return null===r||void 0===r||r(t),function(t,e){let{updateContact:n,botSettings:o,onCallback:r}=e;const{chatRefId:s,recipientId:a,messages:l}=t;return i.d6(s),null===r||void 0===r||r("set-visitor-id",{recipientId:a}),y(l,{updateContact:n,botSettings:o})}(t,{updateContact:s,botSettings:p,onCallback:l})}catch(b){return[{role:"assistant",type:"text",content:b.message||"Unknown Server error"}]}}(t,s,{onReceiveChatResponse:r,updateContact:o,onCallback:c,recipientId:d,chatFlowId:g},l)}(t,J.current)),[]);J.current.updateContact=o.useCallback((async t=>{const e=await Y(t);J.current.setAndBroadcastHistory((t=>t.filter((t=>!g.includes(t.type))).concat(...e)))}),[Y]);const K=o.useCallback((()=>{J.current.setAndBroadcastHistory([]),i.oy(),delete J.current.history,G(700)}),[G]);if(!H||!O)return null;let V="hide-chat";j&&R?V="opening":j&&!R?V="show-chat":!j&&R&&(V="closing"),V+="bottomLeft"===(null===U||void 0===U||null===(e=U.window)||void 0===e?void 0:e.align)?" bottom-left ":" bottom-right ",v&&(V+=" test-console");const X=q&&g.includes(null===(n=q[q.length-1])||void 0===n?void 0:n.type);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(I,{design:U}),(0,d.jsxs)("div",{className:"chat-handler "+V,children:[j&&!!H&&(0,d.jsx)(s.A,{botDesign:U,messages:q,showTime:!0,onUserMessage:Y,disabledMessage:X,onHistoryChange:J.current.setAndBroadcastHistory,onClear:K,onHide:Q,onCallback:J.current.onCallback,optionsRenderer:_}),!j&&!R&&(0,d.jsx)(p,{design:U,onToggle:Q})]})]})};function p(t){let{design:e,onToggle:n}=t;const{launcher:{launcherType:o,buttonLogoUrl:r,buttonOnMobile:s,barText:i,fontSize:a,spacingCorner:c,spacingBottom:u}={},header:{bgColor:g,secBgColor:h,fontColor:p}={},window:{fontFamily:y,align:f}={}}=e||{},m="bottomLeft"===f,C={bottom:u,[m?"left":"right"]:c};return"icon"===o||s?(0,d.jsxs)("div",{id:"lp-launcher",className:"lp-launcher button"+(r?"":" bordered"),onClick:n,style:{borderColor:g,color:p,background:r?"transparent":"linear-gradient(to right,"+g+", "+h+")",verticalAlign:"middle",padding:r?void 0:"16px",display:"flex",...C},children:[(0,d.jsx)(b,{design:e,isLeft:m}),r&&(0,d.jsx)("img",{src:r,alt:"Live Chat"}),!r&&l.Or]}):"expand"===o?(0,d.jsx)(v,{isLeft:m,color:p,style:C,bgColor:g,secBgColor:h,imageUrl:r,chatIcon:l.Or,barText:i,fontSize:a,onClick:n}):(0,d.jsxs)("div",{id:"lp-launcher",className:"lp-launcher bar",onClick:n,style:{background:"linear-gradient(to right, "+g+", "+h+")",color:p,fontFamily:y,...C},children:[l.Or,(0,d.jsx)("span",{children:i||"Live Chat"})]})}function v(t){let{isLeft:e,bgColor:n,secBgColor:r,imageUrl:s,chatIcon:i,barText:a="Live Chat",fontSize:l,color:c,autoAnimate:u=!0,style:g,onClick:h}=t;const p=e?"bottom-left":"bottom-right",v={backgroundColor:n},b={backgroundImage:`linear-gradient(90deg, ${n}, ${r})`},y=o.useRef();return o.useEffect((()=>{if(u){const t=setInterval((()=>{var t;null===(t=y.current)||void 0===t||t.classList.remove("bar-hide"),setTimeout((()=>{var t;return null===(t=y.current)||void 0===t?void 0:t.classList.add("bar-hide")}),7e3)}),35e3);return()=>clearInterval(t)}}),[u]),(0,d.jsxs)("div",{className:`lp-launcher expand-button ${p}`,onClick:h,style:g,children:[(0,d.jsx)("div",{ref:y,className:"text-container bar-hide",style:b,children:(0,d.jsx)("div",{className:"bar-text",style:{minWidth:"150px",fontSize:l,color:c},children:(0,d.jsxs)("p",{children:["Hi there, ",(0,d.jsx)("img",{draggable:!1,className:"chat-hand",alt:"\ud83d\udc4b",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"})," We are online!"]})})}),(0,d.jsx)("div",{className:"image-container",style:v,children:(0,d.jsxs)("div",{className:"image-sub-container",children:[s&&(0,d.jsx)("img",{src:s,alt:a}),!s&&i]})})]})}function b(t){let{text:e="We are Online!",onHide:n,design:r,isLeft:s}=t;const i=function(t,e){let{spacingCorner:n,spacingBottom:o}=(null===t||void 0===t?void 0:t.launcher)||{};if(n=parseFloat(n)||void 0,o=parseFloat(o)||void 0,n&&(n+=5),o&&(o+=75),n||o)return{bottom:o,[e?"left":"right"]:n}}(r,s),[a,l]=o.useState(!0),c=o.useCallback((t=>{t.preventDefault(),t.stopPropagation(),l(!1),null===n||void 0===n||n()}),[n]);return a?(0,d.jsxs)("div",{className:"button-tooltip",style:i,children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("img",{draggable:!1,className:"chat-hand",alt:"\ud83d\udc4b",src:"https://cwc.livserv.in/uploads/Templates/cwc_trend1/hand.png"}),(0,d.jsx)("b",{children:e}),(0,d.jsx)("br",{})]}),(0,d.jsx)("a",{className:"close-indicator",onClick:c,children:(0,d.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 1792 1792",xmlns:"http://www.w3.org/2000/svg",children:(0,d.jsx)("path",{d:"M1490 1245q0 40-24 68l-136 136q-24 24-68 24t-68-28l-294-294-294 294q-24 24-68 24t-68-28l-136-136q-24-24-24-68t24-68l294-294-294-294q-24-24-24-68t24-68l136-136q24-24 68-24t68 28l294 294 294-294q24-24 68-28t68 28l136 136q28 24 24 68t-24 68l-294 294 294 294q24 24 24 68z",fill:"#fff"})})})]}):null}function y(t,e){let{updateContact:n,botSettings:o}=e;if(null===t||void 0===t||!t.length)return t;const r=t[t.length-1];return"form"===r.type&&t.push({role:"user",type:"lead",content:"",profile:r.media,updateContact:n,botSettings:o}),t}async function f(t,e,n,o){let{autoLaunch:r,startupMessages:s}=o;const{_id:l,organizationId:c,botSettings:d={}}=t,u=i.Db();if(!e||!u)return r?s||[{role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"}]:[];try{const t=await a.Jt(`/bot/${c}/${l}/chat/history/${e}/${u}`,null,{noAuth:!0}),{messages:o}=t||{};return y(o,{updateContact:n,botSettings:d})}catch(g){console.error("Failed to fetch chat history:-",g)}return r?[{role:"assistant",type:"text",content:"Hello, greetings for the day, how may I assist you?"}]:[]}let m=null;function C(t){let{onHistoryChange:e,getHistory:n,origin:o=null,botId:r=null}=t;return t=>{const s=t.data||{};if(s.origin===o&&s.botId===r)try{if("GetConversationId"===s.action){w(n(),o,r)}else if("SetConversationId"===s.action){const{conversationId:t,history:n}=s;t?i.d6(t||void 0):i.oy(),n&&(null===e||void 0===e||e(n))}}catch(a){console.log("Error occurred when trying to handle session sharing:",a)}}}function w(t,e,n,o){if(m)try{const r=i.Db()||"";if(!o&&!r)return;m.postMessage({action:"SetConversationId",origin:e,botId:n,conversationId:r,history:t})}catch(r){console.error("Error sharing session:",r)}}function I(t){let{design:e}=t;const n=null===e||void 0===e?void 0:e.remoteFontLink;return n?r.createPortal((0,d.jsx)("link",{rel:"stylesheet",href:n}),document.head,"remoteFont"):null}},4709:(t,e,n)=>{n.d(e,{Db:()=>l,a:()=>u,d6:()=>c,oy:()=>d});var o=n(87946),r=n(44364),s=n(8478);const i="lp-cid";let a;function l(){try{return sessionStorage.getItem(i)}catch(t){return console.error("Unable to use browser cache",t),a}}function c(t){try{a=t,sessionStorage.setItem(i,t)}catch(e){console.error("Unable to use browser cache",e)}}function d(){try{a=void 0,sessionStorage.removeItem(i)}catch(t){console.error("Unable to use browser cache",t)}}async function u(){var t,e,n;const i=r.pR;let a=null;const l=sessionStorage.getItem("locationDetails");if(l)try{a=JSON.parse(l)}catch(L){a={country:"Unavailable",city:"Unavailable",ip:"Unavailable",unavailable_reason:"Error parsing from sessionStorage"}}else a=await s.Jt(`https://api.ipdata.co?api-key=${i}`).catch((t=>({country:"Unavailable",city:"Unavailable",ip:"Unavailable",unavailable_reason:t.message}))),sessionStorage.setItem("locationDetails",JSON.stringify(a));const c=(new o.UAParser).getResult()||{},{ip:d,is_eu:u,city:h,region:p,region_code:v,region_type:b,country_name:y,country_code:f,continent_name:m,continent_code:C,latitude:w,longitude:I,postal:x,calling_code:S,time_zone:k,currency:_}=a,j={ipAddress:d,deviceType:null===(t=c.device)||void 0===t?void 0:t.type,browserName:null===(e=c.browser)||void 0===e?void 0:e.name,osName:null===(n=c.os)||void 0===n?void 0:n.name,...g()};return j.locationDetails={is_eu:u,city:h,region:p,region_code:v,region_type:b,country_name:y,country_code:f,continent_name:m,continent_code:C,latitude:w,longitude:I,postal:x,calling_code:S,time_zone:k,currency:_},j}function g(){const t=new URLSearchParams(window.location.search),e=t.get("sourceUrl")||void 0,n=t.get("referrerUrl")||void 0;return{utmParameters:Array.from(t.keys()).reduce(((e,n)=>{if(n.startsWith("utm_")){e=e||{};const o=t.get(n);o&&"null"!==o&&(e[n]=o)}return e}),void 0),sourceUrl:e,referrerUrl:n}}},13938:()=>{}}]);