"use strict";(self.webpackChunklib_prop_ui=self.webpackChunklib_prop_ui||[]).push([[2833],{93383:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(9950),a=n(10226),s=n(46639),l=n(44414);const c=function(e){let{onClick:t,disabled:n,isLoading:c,children:i,...r}=e;const[d,u]=o.useState(c);return(0,l.jsxs)(a.A,{onClick:e=>{if(!t)return;const n=t(e);"function"===typeof(null===n||void 0===n?void 0:n.finally)&&(u(!0),n.finally((()=>u(!1))))},disabled:d||c||n,...r,children:[(d||c)&&(0,l.jsx)(s.A,{size:16,color:"primary",style:{marginRight:"10px"}}),i]})}},11374:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var o=n(9950),a=n(39320),s=n(33340),l=n(8478);function c(e){return{value:e._id,label:"v".concat(e.version," - ").concat(e.deployedAt?"Deployed":"Draft")}}var i=n(32026);const r=o.createContext({}),d="start-web";const u=function(e,t){const n=(0,s.nc)((e=>e.selectedBotId)),c=(0,s.nc)((e=>e.organizationId)),[r,u]=o.useState(f(t)),p=o.useRef({flowData:r});p.current.flowId=e,p.current.flowData=r,o.useEffect((()=>{var t;e&&(null===(t=p.current.flowData)||void 0===t?void 0:t._id)!==e&&async function(e,t,n){return await l.Jt("/bot/".concat(e,"/").concat(t,"/chat-flow/").concat(n))}(c,n,e).then(u)}),[e,n,c]),o.useEffect((()=>{!p.current.flowId&&t&&u(f(t))}),[t]);const h=o.useMemo((()=>{const e=[],t=[{id:d,type:"input",data:{label:"Chat window opened"},position:{x:10,y:10}}];if(!r)return{};const{_id:n,startFlowId:o,deployedAt:s,flows:l}=r;return o&&e.push({id:"start-handle",source:d,target:o,markerEnd:{type:a.TG.ArrowClosed}}),l.forEach(((n,o)=>{const s=o%4,l=Math.ceil(o/4),{designProps:c={}}=n;t.push({id:n.flowId,type:n.type,dragHandle:".header",data:n,position:c.position||{x:100*(s+1)+280*s,y:90*(l+1)+250*l}}),"options"===n.type&&n.children.forEach((t=>{var o;const s=n.flowId,l=t.nextFlowId;t.id||(t.id=(0,i.OX)()),!t.leadEmail||null!==(o=t.settings)&&void 0!==o&&o.leadEmail||(t.settings?t.settings.leadEmail=t.leadEmail:t.settings={leadEmail:t.leadEmail},delete t.leadEmail);const c=t.id,r="".concat(s,"_").concat(c,"_").concat(l);e.push({id:r,source:s,target:l,type:"smoothstep",sourceHandle:c,markerEnd:{type:a.TG.ArrowClosed}})}))})),{nodes:t,edges:e,flowData:r,flowId:n,allowDeploy:!s&&!!n,setFlowData:u}}),[r]);return h.organizationId=c,h.botId=n,h};function f(e){if(e)return{flows:[]}}var p=n(85668),h=n(44414);const v=function(e){let{title:t,style:n,selected:o,hideHandle:s,children:l}=e;return(0,h.jsxs)("div",{className:"flow-item-container"+(o?" selected":""),style:n,children:[(0,h.jsxs)("div",{className:"header",children:[(0,h.jsx)(a.h7,{type:"target",position:a.yX.Left}),(0,h.jsx)("span",{children:t})]}),(0,h.jsxs)("div",{className:"body",children:[!s&&(0,h.jsx)(a.h7,{type:"source",position:a.yX.Right}),l]})]})};const g=function(e){return(0,h.jsx)(v,{selected:e.selected,title:"Lead Form",children:"This will display lead form for the visitor."})};var w=n(8145);const y=function(e){let{field:t,value:n,placeholder:a="Please edit this text",onChange:s}=e;const[l,c]=o.useState(!1),[i,r]=o.useState(n),d=o.useCallback((()=>{c((e=>!e)),r(n)}),[n]),u=()=>{s(i,t),d()};return l?(0,h.jsx)(w.A,{autoFocus:!0,value:i,size:"small",placeholder:a,onBlur:u,onChange:e=>r(e.currentTarget.value)}):(0,h.jsx)("div",{className:"inline-edit"+(n?"":" placeholder"),onClick:d,children:n||a})};function x(e){const{data:t}=e,n=o.useContext(r),[a,s]=o.useState(t);o.useEffect((()=>{s(t)}),[t]);return{state:a,setState:s,setValue:(t,o)=>s((a=>{const s=(0,i.do)(a,o,t);return n.updateFlow(s,e),s}))}}const E=function(e){const{state:t,setValue:n}=x(e);return(0,h.jsx)(v,{selected:e.selected,title:"Message",style:{width:"250px",position:"relative"},children:(0,h.jsx)(y,{value:t.content,field:"content",onChange:n})})};var _=n(10226);const A=function(e){let{field:t,value:n,onChange:a,...s}=e;const[l,c]=o.useState(n);return o.useEffect((()=>{c(n)}),[n]),(0,h.jsx)(w.A,{value:l,size:"small",...s,onChange:e=>c(e.currentTarget.value),onBlur:()=>a(l,t)})};const m={leadForm:g,message:E,options:function(e){var t,n,s,l;const{state:c,setValue:r}=x(e),[d,u]=o.useState({title:"",value:""}),f=(e,t)=>u((n=>(0,i.do)(n,t,e)));return(0,h.jsxs)(v,{title:"Options",selected:e.selected,style:{width:"250px"},handleId:c.flowId,hideHandle:!0,children:[(0,h.jsx)("span",{children:"Display Text"}),(0,h.jsx)(A,{placeholder:"Display Text",value:c.displayText,field:"displayText",onChange:r}),(0,h.jsx)("span",{children:"Property Name"}),(0,h.jsx)(A,{placeholder:"Property Name",value:c.property,field:"property",onChange:r}),(0,h.jsx)("span",{children:"Message"}),(0,h.jsx)(A,{placeholder:"Display Text",value:c.content,field:"content",onChange:r}),(0,h.jsxs)("fieldset",{children:[(0,h.jsx)("legend",{children:"Add Options"}),(0,h.jsx)(A,{placeholder:"Option Title",value:d.title,field:"title",onChange:f}),(0,h.jsx)(A,{placeholder:"Option Subtitle",value:d.subTitle,field:"subTitle",onChange:f}),(0,h.jsx)(A,{placeholder:"Option value",value:d.value,field:"value",onChange:f}),(0,h.jsx)("span",{children:"Lead Email"}),(0,h.jsx)(A,{placeholder:"To Mail Id",value:null===(t=d.settings)||void 0===t||null===(n=t.leadEmail)||void 0===n?void 0:n.to,field:"settings.leadEmail.to",onChange:f}),(0,h.jsx)(A,{placeholder:"CC Mail Id",value:null===(s=d.settings)||void 0===s||null===(l=s.leadEmail)||void 0===l?void 0:l.cc,field:"settings.leadEmail.cc",onChange:f}),(0,h.jsx)(_.A,{size:"small",type:"button",variant:"contained",color:"success",onClick:()=>{r(d,"children.".concat(c.children.length)),u({title:"",value:""})},children:"+"})]}),(0,h.jsx)("div",{children:c.children.map((e=>(0,h.jsxs)("div",{style:{width:"100%",padding:"4px 10px",border:"1px solid grey",borderRadius:"6px",margin:"10px 0",position:"relative"},children:[(0,h.jsx)("span",{children:e.title}),(0,h.jsx)(a.h7,{type:"source",position:a.yX.Right,id:e.id})]},e.id)))})]})},start:function(){return(0,h.jsx)("div",{children:"Start"})},gpt:function(e){return(0,h.jsx)(v,{selected:e.selected,title:"GPT Handler",children:"From here on visitors query would be handled by GPT"})}};var C=n(93383);const T=function(e){let{name:t,type:n}=e;return(0,h.jsx)("div",{className:"flow-item",onDragStart:e=>{e.dataTransfer.setData("application/reactflow",n),e.dataTransfer.effectAllowed="move"},draggable:!0,children:t})};const j=function(e){let{list:t,onChange:n}=e;return t?(0,h.jsx)("div",{children:(0,h.jsx)("select",{onChange:e=>n(e.currentTarget.value),style:{width:"100%"},children:t.map(((e,t)=>(0,h.jsx)("option",{value:e.value,children:e.label},t)))})}):"Loading..."};const I=function(){const e=o.useContext(r);return(0,h.jsxs)("div",{className:"control-panel",children:[(0,h.jsx)("div",{children:(0,h.jsx)(j,{list:e.getFlowList(),onChange:e.selectFlow})}),(0,h.jsxs)("div",{className:"flow-items-list",children:[(0,h.jsx)(T,{name:"Message",type:"message"}),(0,h.jsx)(T,{name:"Options List",type:"options"}),(0,h.jsx)(T,{name:"Lead Form",type:"leadForm"}),(0,h.jsx)(T,{name:"Lead Flow",type:"leadFlow"}),(0,h.jsx)(T,{name:"GPT",type:"gpt"})]}),(0,h.jsxs)("div",{className:"buttons",children:[(0,h.jsx)(C.A,{variant:"contained",fullWidth:!0,color:"primary",onClick:e.saveFlow,children:"Save"}),e.allowDeploy()&&(0,h.jsx)(C.A,{variant:"contained",fullWidth:!0,style:{marginTop:"8px"},color:"secondary",onClick:e.deployFlow,children:"Deploy"})]})]})};n(522);const b=function(e){let{flowData:t}=e;const n=o.useContext(r),[s,l,c]=(0,a.ck)(t.nodes),[d,u,f]=(0,a.fM)(t.edges),[v,g]=o.useState(null),w=o.useRef({context:n});w.current.context=n,w.current.setNodes=l,w.current.onNodesChange=c,w.current.setEdges=u,w.current.reactFlowInstance=v,o.useEffect((()=>{const{setNodes:e,setEdges:n}=w.current;e(t.nodes),n(t.edges)}),[t]);const y=o.useCallback((e=>u((t=>(0,a.rN)(e,t)))),[u]);w.current.onConnect=y;const x=o.useCallback((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),E=o.useCallback((e=>{e.preventDefault();const t=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof t||!t)return;const{context:n,setNodes:o,reactFlowInstance:a}=w.current,s=a.screenToFlowPosition({x:e.clientX,y:e.clientY}),l=function(e){let t={flowId:(0,i.OX)(),type:e};"options"===e?t={...t,children:[],content:"",property:"",displayText:""}:"message"===e&&(t={...t,content:"Edit this message with the message to be sent to visitors."});return t}(t),c={id:l.flowId,type:t,position:s,data:l};n.updateFlow(c.data,c),o((e=>e.concat(c)))}),[]),_=o.useCallback((function(e){const{context:t,onNodesChange:n,reactFlowInstance:o}=w.current;if(o){const n=e=>{if(!e)return;const{id:n,position:o}=e;n&&o&&t.updateFlowProperties(n,"designProps.position",o)};Array.isArray(e)?e.forEach(n):n(e)}for(var a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];n(e,...s)}),[]),A=o.useCallback((function(e){const{context:t,onConnect:n}=w.current;t.updateFlowLink(e);for(var o=arguments.length,a=new Array(o>1?o-1:0),s=1;s<o;s++)a[s-1]=arguments[s];n(e,...a)}),[]);return(0,h.jsxs)("div",{className:"flow-design-container",children:[(0,h.jsx)("div",{className:"flow-board",children:(0,h.jsx)(a.Gc,{nodes:s,edges:d,onNodesChange:_,onEdgesChange:f,onConnect:A,onInit:g,onDrop:E,onDragOver:x,fitView:!0,attributionPosition:"top-right",nodeTypes:m,proOptions:{hideAttribution:!0},children:(0,h.jsx)(p.V,{color:"#aaa",gap:16})})}),(0,h.jsx)(I,{})]})};const P=function(){const[e,t]=o.useState(),[n,a]=o.useState("");o.useEffect((()=>{(async function(){const{selectedBotId:e,organizationId:t}=s.nc.getState();return(await l.Jt("/bot/".concat(t,"/").concat(e,"/chat-flow"))).map(c)})().then((e=>{var n;t(e),a(null===(n=e[0])||void 0===n?void 0:n.value)}))}),[]);const f=u(n,0===(null===e||void 0===e?void 0:e.length)),{flowData:p}=f||{},[v,g]=o.useState(p),w=o.useRef({});w.current.flowList=e,w.current.flow=f,w.current.state=v,o.useEffect((()=>{g(p)}),[p]);const y=o.useMemo((()=>{const e=async e=>{var n;const{state:o,flow:s}=w.current,i=await async function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a="/bot/".concat(e,"/").concat(t,"/chat-flow").concat(o?"?deploy=true":"");return await l.bE(a,n)}(s.organizationId,s.botId,o,!0===e);let r=[...w.current.flowList];const d=r.findIndex((e=>e.value===i._id)),u=c(i);var f,p;(d>=0?r[d]=u:r.splice(0,0,u),e||(null===(n=w.current.flow)||void 0===n?void 0:n.flowId)!==i._id)&&(t(r),a(i._id),null===(f=w.current.flow)||void 0===f||null===(p=f.setFlowData)||void 0===p||p.call(f,i))};return{getFlowList:()=>w.current.flowList,selectFlow:a,updateFlow:(e,t)=>{const{xPos:n,yPos:o}=t||{},{x:a,y:s}=(null===t||void 0===t?void 0:t.position)||{x:n,y:o};g((t=>{const n=[...t.flows];t={...t,flows:n};const o=n.findIndex((t=>t.flowId===e.flowId));return o>=0?n[o]=e:n.push(e),(0,i.do)(t,"designProps.position",{x:a,y:s})}))},updateFlowProperties:(e,t,n)=>{g((o=>{const a=o.flows.findIndex((t=>t.flowId===e));return a>=0?(0,i.do)(o,"flows.".concat(a,".").concat(t),n):o}))},updateFlowLink:e=>{if(!e)return;const t={...w.current.state};let n=!1;const o=e=>{const{source:o,sourceHandle:a,target:s}=e;if(o===d)t.startFlowId=s||void 0;else{const e=t.flows.findIndex((e=>e.flowId===o));if(e>=0){const n={...t.flows[e]};if(t.flows=[...t.flows],t.flows[e]=n,a){if(n.children){var l;const e=null===(l=n.children)||void 0===l?void 0:l.findIndex((e=>e.id===a));if(e>=0){n.children[e].nextFlowId=s||void 0}}}else n.nextFlowId=s||void 0}}n=!0};Array.isArray(e)?e.forEach(o):o(e),n&&g(t)},allowDeploy:()=>{var e;return null===(e=w.current.flow)||void 0===e?void 0:e.allowDeploy},saveFlow:()=>e(!1),deployFlow:()=>e(!0)}}),[]);if(p)return(0,h.jsx)(r.Provider,{value:y,children:(0,h.jsx)(b,{flowData:f})})}},8478:(e,t,n)=>{n.d(t,{Jt:()=>s,Ne:()=>u,TF:()=>i,bE:()=>l,yJ:()=>c});var o=n(32026),a=n(44364);async function s(e,t){return r("GET",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function l(e,t){return r("POST",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function c(e,t){return r("PUT",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function i(e,t){return r("DELETE",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function r(e,t,n){let{headers:o,noAuth:a,...s}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const l="POST"===e||"PUT"===e||"DELETE"===e;t=u(t,l?void 0:n);const c=n instanceof FormData;if(c||(n=n&&"object"===typeof n&&l?JSON.stringify(n):void 0),o||(o={}),c||(o["Content-Type"]="application/json"),o.Accept="application/json",!1!==a){const e=sessionStorage.getItem("token");e&&(o.Authorization="Bearer ".concat(e))}try{const a=await fetch(t,{...s,headers:o,body:n,method:e}),l=await a.json();if(a.ok){const{data:e,...t}=l;return delete t.status,e&&!Object.keys(t).length?e:l}throw l.message?new Error(l.message):l}catch(r){var i;throw console.error("Error calling API: ",r),null!==(i=r.message)&&void 0!==i&&i.includes("fetch")?new Error("Unable to reach server. Please check your network connectivity and try again."):new Error(r.message)}}const d=(0,o.s8)(a.jn,"/");function u(e,t){if(!e)return e;const n=t&&Object.keys(t);if(null!==n&&void 0!==n&&n.length){const o=n.reduce(((e,n)=>{let o=t[n];return null===o||void 0===o?e:(o="".concat(n,"=").concat(encodeURIComponent(o)),e?"".concat(e,"&").concat(o):o)}),"");o&&(e="".concat(e).concat(e.includes("?")?"&":"?").concat(o))}return e.startsWith("https://")?e:"".concat(d).concat(e)}},32026:(e,t,n)=>{function o(e,t){return e.replace(new RegExp("".concat(a(t),"+$")),"")}function a(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s(e){const t=new Date(e),n=t.getDate(),o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],a=t.getFullYear();return"".concat(o," ").concat(n,", ").concat(a)}function l(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const a=t.indexOf("."),s=t.substring(0,a),c=t.substring(a+1);o[s]=l(e[s],c,n)}else o[t]=n;return o}function c(e,t){return btoa("".concat(e,"_").concat(t,"_whatsapp_int"))}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(36*Math.random()));return n}function r(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const a=t.indexOf("."),s=t.substring(0,a),l=t.substring(a+1);o[s]=r(e[s],l,n)}else o[t]=n;return o}n.d(t,{G6:()=>l,OX:()=>i,Yq:()=>s,do:()=>r,qW:()=>c,s8:()=>o})},44364:(e,t,n)=>{n.d(t,{DX:()=>c,Og:()=>s,jn:()=>o,pA:()=>l,pR:()=>a});const o="https://devbackend.livhousing.com",a="c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",s={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com"}.TRAINING_MEDIA_MAXSIZE,l={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com"}.CONVERSATION_MEDIA_MAXSIZE,c={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com"}.REACT_APP_NGROK_BACKEND_URL||"https://devbackend.livhousing.com"}}]);