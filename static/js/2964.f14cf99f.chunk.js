"use strict";(self.webpackChunklib_prop_ui=self.webpackChunklib_prop_ui||[]).push([[2964],{93383:(e,t,n)=>{n.d(t,{A:()=>a});var o=n(9950),s=n(10226),l=n(46639),i=n(44414);const a=function(e){let{onClick:t,disabled:n,isLoading:a,children:r,...c}=e;const[d,u]=o.useState(a);return(0,i.jsxs)(s.A,{onClick:e=>{if(!t)return;const n=t(e);"function"===typeof(null===n||void 0===n?void 0:n.finally)&&(u(!0),n.finally((()=>u(!1))))},disabled:d||a||n,...c,children:[(d||a)&&(0,i.jsx)(l.A,{size:16,color:"primary",style:{marginRight:"10px"}}),r]})}},42057:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var o=n(9950),s=n(39320),l=n(33340),i=n(28564),a=n(32026);const r=o.createContext({}),c="start-web";const d=function(e,t){const n=(0,l.nc)((e=>e.selectedBotId)),r=(0,l.nc)((e=>e.organizationId)),[d,f]=o.useState(u(t)),p=o.useRef({flowData:d});p.current.flowId=e,p.current.flowData=d,o.useEffect((()=>{var t;e&&(null===(t=p.current.flowData)||void 0===t?void 0:t._id)!==e&&(0,i.Gl)(r,n,e).then(f)}),[e,n,r]),o.useEffect((()=>{!p.current.flowId&&t&&f(u(t))}),[t]);const h=o.useMemo((()=>{const e=[],t=[{id:c,type:"input",data:{label:"Chat window opened"},position:{x:10,y:10}}];if(!d)return{};const{_id:n,startFlowId:o,deployedAt:l,flows:i}=d;return o&&e.push({id:"start-handle",source:c,target:o,markerEnd:{type:s.TG.ArrowClosed}}),i.forEach(((n,o)=>{const l=o%4,i=Math.ceil(o/4),{designProps:r={}}=n;if(t.push({id:n.flowId,type:n.type,dragHandle:".header",data:n,position:r.position||{x:100*(l+1)+280*l,y:90*(i+1)+250*i}}),"options"===n.type)n.children.forEach((t=>{var o;const l=n.flowId,i=t.nextFlowId;t.id||(t.id=(0,a.OX)()),!t.leadEmail||null!==(o=t.settings)&&void 0!==o&&o.leadEmail||(t.settings?t.settings.leadEmail=t.leadEmail:t.settings={leadEmail:t.leadEmail},delete t.leadEmail);const r=t.id,c=`${l}_${r}_${i}`;e.push({id:c,source:l,target:i,type:"smoothstep",sourceHandle:r,markerEnd:{type:s.TG.ArrowClosed}})}));else{const t=n.flowId,o=n.nextFlowId,l=`${t}_null_${o}`;e.push({id:l,source:t,target:o,type:"smoothstep",markerEnd:{type:s.TG.ArrowClosed}})}})),{nodes:t,edges:e,flowData:d,flowId:n,allowDeploy:!l&&!!n,setFlowData:f}}),[d]);return h.organizationId=r,h.botId=n,h};function u(e){if(e)return{flows:[]}}var f=n(85668),p=n(44414);const h=function(e){let{title:t,style:n,selected:o,hideHandle:l,children:i}=e;return(0,p.jsxs)("div",{className:"flow-item-container"+(o?" selected":""),style:n,children:[(0,p.jsxs)("div",{className:"header",children:[(0,p.jsx)(s.h7,{type:"target",position:s.yX.Left}),(0,p.jsx)("span",{children:t})]}),(0,p.jsxs)("div",{className:"body",children:[!l&&(0,p.jsx)(s.h7,{type:"source",position:s.yX.Right}),i]})]})};const v=function(e){return(0,p.jsx)(h,{selected:e.selected,title:"Lead Form",children:"This will display lead form for the visitor."})};var g=n(8145);const w=function(e){let{field:t,value:n,placeholder:s="Please edit this text",onChange:l}=e;const[i,a]=o.useState(!1),[r,c]=o.useState(n),d=o.useCallback((()=>{a((e=>!e)),c(n)}),[n]),u=()=>{l(r,t),d()};return i?(0,p.jsx)(g.A,{autoFocus:!0,value:r,size:"small",onKeyUp:e=>e.stopPropagation(),placeholder:s,onBlur:u,onChange:e=>c(e.currentTarget.value)}):(0,p.jsx)("div",{className:"inline-edit"+(n?"":" placeholder"),onClick:d,children:n||s})};function y(e){const{data:t}=e,n=o.useContext(r),[s,l]=o.useState(t);o.useEffect((()=>{l(t)}),[t]);return{state:s,setState:l,setValue:(t,o)=>l((s=>{const l=(0,a.do)(s,o,t);return n.updateFlow(l,e),l}))}}const E=function(e){const{state:t,setValue:n}=y(e);return(0,p.jsx)(h,{selected:e.selected,title:"Message",style:{width:"250px",position:"relative"},children:(0,p.jsx)(w,{value:t.content,field:"content",onChange:n})})};var x=n(10226);const _=function(e){let{field:t,value:n,onChange:s,...l}=e;const[i,a]=o.useState(n);return o.useEffect((()=>{a(n)}),[n]),(0,p.jsx)(g.A,{value:i,size:"small",...l,onChange:e=>a(e.currentTarget.value),onBlur:()=>s(i,t)})};const C={leadForm:v,message:E,options:function(e){var t,n,l,i;const{state:r,setValue:c}=y(e),[d,u]=o.useState({title:"",subTitle:"",value:""}),f=(e,t)=>u((n=>(0,a.do)(n,t,e)));return(0,p.jsxs)(h,{title:"Options",selected:e.selected,style:{width:"250px"},handleId:r.flowId,hideHandle:!0,children:[(0,p.jsx)("span",{children:"Display Text"}),(0,p.jsx)(_,{placeholder:"Display Text",value:r.displayText,field:"displayText",onChange:c}),(0,p.jsx)("span",{children:"Property Name"}),(0,p.jsx)(_,{placeholder:"Property Name",value:r.property,field:"property",onChange:c}),(0,p.jsx)("span",{children:"Message"}),(0,p.jsx)(_,{placeholder:"Display Text",value:r.content,field:"content",onChange:c}),(0,p.jsxs)("fieldset",{children:[(0,p.jsx)("legend",{children:"Add Options"}),(0,p.jsx)(_,{placeholder:"Option Title",value:d.title,field:"title",onChange:f}),(0,p.jsx)(_,{placeholder:"Option Subtitle",value:d.subTitle,field:"subTitle",onChange:f}),(0,p.jsx)(_,{placeholder:"Option value",value:d.value,field:"value",onChange:f}),(0,p.jsx)("span",{children:"Lead Email"}),(0,p.jsx)(_,{placeholder:"To Mail Id",value:null===(t=d.settings)||void 0===t||null===(n=t.leadEmail)||void 0===n?void 0:n.to,field:"settings.leadEmail.to",onChange:f}),(0,p.jsx)(_,{placeholder:"CC Mail Id",value:null===(l=d.settings)||void 0===l||null===(i=l.leadEmail)||void 0===i?void 0:i.cc,field:"settings.leadEmail.cc",onChange:f}),(0,p.jsx)(x.A,{size:"small",type:"button",variant:"contained",color:"success",onClick:()=>{c(d,`children.${r.children.length}`),u({title:"",subTitle:"",value:""})},children:"+"})]}),(0,p.jsx)("div",{children:r.children.map((e=>(0,p.jsxs)("div",{style:{width:"100%",padding:"4px 10px",border:"1px solid grey",borderRadius:"6px",margin:"10px 0",position:"relative"},children:[(0,p.jsx)("span",{children:e.title}),(0,p.jsx)(s.h7,{type:"source",position:s.yX.Right,id:e.id})]},e.id)))})]})},start:function(){return(0,p.jsx)("div",{children:"Start"})},gpt:function(e){return(0,p.jsx)(h,{selected:e.selected,title:"GPT Handler",children:"From here on visitors query would be handled by GPT"})},stop:function(e){return(0,p.jsx)(h,{selected:e.selected,title:"Stop Chat",hideHandle:!0,children:"The chat will stop here"})}};var m=n(93383);const A=function(e){let{name:t,type:n}=e;return(0,p.jsx)("div",{className:"flow-item",onDragStart:e=>{e.dataTransfer.setData("application/reactflow",n),e.dataTransfer.effectAllowed="move"},draggable:!0,children:t})};const T=function(e){let{list:t,onChange:n}=e;return t?(0,p.jsx)("div",{children:(0,p.jsx)("select",{onChange:e=>n(e.currentTarget.value),style:{width:"100%"},children:t.map(((e,t)=>(0,p.jsx)("option",{value:e.value,children:e.label},t)))})}):"Loading..."};const j=function(){const e=o.useContext(r);return(0,p.jsxs)("div",{className:"control-panel",children:[(0,p.jsx)("div",{children:(0,p.jsx)(T,{list:e.getFlowList(),onChange:e.selectFlow})}),(0,p.jsxs)("div",{className:"flow-items-list",children:[(0,p.jsx)(A,{name:"Message",type:"message"}),(0,p.jsx)(A,{name:"Options List",type:"options"}),(0,p.jsx)(A,{name:"Lead Form",type:"leadForm"}),(0,p.jsx)(A,{name:"Lead Flow",type:"leadFlow"}),(0,p.jsx)(A,{name:"GPT",type:"gpt"}),(0,p.jsx)(A,{name:"Stop",type:"stop"})]}),(0,p.jsxs)("div",{className:"buttons",children:[(0,p.jsx)(m.A,{variant:"contained",fullWidth:!0,color:"primary",onClick:e.saveFlow,children:"Save"}),e.allowDeploy()&&(0,p.jsx)(m.A,{variant:"contained",fullWidth:!0,style:{marginTop:"8px"},color:"secondary",onClick:e.deployFlow,children:"Deploy"})]})]})};n(522);const I=function(e){let{flowData:t}=e;const n=o.useContext(r),[l,i,c]=(0,s.ck)(t.nodes),[d,u,h]=(0,s.fM)(t.edges),[v,g]=o.useState(null),w=o.useRef({context:n});w.current.context=n,w.current.setNodes=i,w.current.onNodesChange=c,w.current.setEdges=u,w.current.reactFlowInstance=v,w.current.edges=d,o.useEffect((()=>{const{setNodes:e,setEdges:n}=w.current;e(t.nodes),n(t.edges)}),[t]),(0,s.p4)({onChange:e=>{w.current.selectedItems=e}});const y=o.useCallback((e=>u((t=>(0,s.rN)(e,t)))),[u]);w.current.onConnect=y;const E=o.useCallback((e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"}),[]),x=o.useCallback((e=>{e.preventDefault();const t=e.dataTransfer.getData("application/reactflow");if("undefined"===typeof t||!t)return;const{context:n,setNodes:o,reactFlowInstance:s}=w.current,l=s.screenToFlowPosition({x:e.clientX,y:e.clientY}),i=function(e){let t={flowId:(0,a.OX)(),type:e};"options"===e?t={...t,children:[],content:"",property:"",displayText:""}:"message"===e&&(t={...t,content:""});return t}(t),r={id:i.flowId,type:t,position:l,data:i};n.updateFlow(r.data,r),o((e=>e.concat(r)))}),[]),_=o.useCallback((function(e){const{context:t,onNodesChange:n,reactFlowInstance:o}=w.current;if(o){const n=e=>{if(!e)return;const{id:n,position:o}=e;n&&o&&t.updateFlowProperties(n,"designProps.position",o)};Array.isArray(e)?e.forEach(n):n(e)}for(var s=arguments.length,l=new Array(s>1?s-1:0),i=1;i<s;i++)l[i-1]=arguments[i];n(e,...l)}),[]),m=o.useCallback((function(e){const{context:t,onConnect:n}=w.current;t.updateFlowLink(e);for(var o=arguments.length,s=new Array(o>1?o-1:0),l=1;l<o;l++)s[l-1]=arguments[l];n(e,...s)}),[]),A=o.useCallback((e=>{var t;if("delete"===(null===(t=e.code)||void 0===t?void 0:t.toLowerCase())){var n;const{context:e,selectedItems:t,edges:o,setNodes:s,setEdges:l}=w.current;if(!t)return;const{nodes:i}=t;let{edges:a}=t;if(a=[...a],null!==i&&void 0!==i&&i.length&&null!==o&&void 0!==o&&o.length){const e=i.map((e=>e.id)),t=o.filter((t=>e.includes(t.target)));t.length&&a.push(...t)}if(e.remove({nodes:i,edges:a}),null!==i&&void 0!==i&&i.length){const e=i.map((e=>e.id));s((t=>t.filter((t=>!e.includes(t.id)))))}if(null!==(n=a)&&void 0!==n&&n.length){const e=a.map((e=>e.id));l((t=>t.filter((t=>!e.includes(t.id)))))}}}),[]);return(0,p.jsxs)("div",{className:"flow-design-container",children:[(0,p.jsx)("div",{className:"flow-board",onKeyUp:A,children:(0,p.jsx)(s.Gc,{nodes:l,edges:d,onNodesChange:_,onEdgesChange:h,onConnect:m,onInit:g,onDrop:x,onDragOver:E,fitView:!0,attributionPosition:"top-right",nodeTypes:C,proOptions:{hideAttribution:!0},children:(0,p.jsx)(f.V,{color:"#aaa",gap:16})})}),(0,p.jsx)(j,{})]})};const P=function(){const[e,t]=o.useState(),[n,l]=o.useState("");o.useEffect((()=>{(0,i.Ek)().then((e=>{var n;t(e),l(null===(n=e[0])||void 0===n?void 0:n.value)}))}),[]);const c=d(n,0===(null===e||void 0===e?void 0:e.length)),{flowData:u}=c||{},[f,h]=o.useState(u),v=o.useRef({});v.current.flowList=e,v.current.flow=c,v.current.state=f,o.useEffect((()=>{h(u)}),[u]);const g=o.useMemo((()=>{const e=async e=>{var n;const{state:o,flow:s}=v.current,a=await(0,i.EZ)(s.organizationId,s.botId,o,!0===e);let r=[...v.current.flowList];const c=r.findIndex((e=>e.value===a._id)),d=(0,i.CC)(a);var u,f;(c>=0?r[c]=d:r.splice(0,0,d),e||(null===(n=v.current.flow)||void 0===n?void 0:n.flowId)!==a._id)&&(t(r),l(a._id),null===(u=v.current.flow)||void 0===u||null===(f=u.setFlowData)||void 0===f||f.call(u,a))};return{getFlowList:()=>v.current.flowList,selectFlow:l,updateFlow:(e,t)=>{const{xPos:n,yPos:o}=t||{},{x:s,y:l}=(null===t||void 0===t?void 0:t.position)||{x:n,y:o};h((t=>{const n=[...t.flows];t={...t,flows:n};const o=n.findIndex((t=>t.flowId===e.flowId));return o>=0?n[o]=e:n.push(e),(0,a.do)(t,"designProps.position",{x:s,y:l})}))},updateFlowProperties:(e,t,n)=>{h((o=>{const s=o.flows.findIndex((t=>t.flowId===e));return s>=0?(0,a.do)(o,`flows.${s}.${t}`,n):o}))},updateFlowLink:e=>{if(!e)return;const t={...v.current.state};let n=!1;const o=e=>{const{source:o,sourceHandle:s,target:l}=e;S(t,o,s,l),n=!0};Array.isArray(e)?e.forEach(o):o(e),n&&h(t)},remove:e=>{let{nodes:t,edges:n}=e;if((null===t||void 0===t||!t.length)&&(null===n||void 0===n||!n.length))return;const o={...v.current.state};if(null===n||void 0===n||n.forEach((e=>{const{source:t,sourceHandle:n}=e;S(o,t,n)})),null!==t&&void 0!==t&&t.length){const e=t.map((e=>e.id));o.flows=o.flows.filter((t=>!e.includes(t.flowId)))}h(o)},allowDeploy:()=>{var e;return null===(e=v.current.flow)||void 0===e?void 0:e.allowDeploy},saveFlow:()=>e(!1),deployFlow:()=>e(!0)}}),[]);if(u)return(0,p.jsx)(r.Provider,{value:g,children:(0,p.jsx)(s.Ln,{children:(0,p.jsx)(I,{flowData:c})})})};function S(e,t,n,o){if(t===c)e.startFlowId=o||void 0;else{const l=e.flows.findIndex((e=>e.flowId===t));if(l>=0){const t={...e.flows[l]};if(e.flows=[...e.flows],e.flows[l]=t,n){if(t.children){var s;const e=null===(s=t.children)||void 0===s?void 0:s.findIndex((e=>e.id===n));if(e>=0){t.children[e].nextFlowId=o||void 0}}}else t.nextFlowId=o||void 0}}}},8478:(e,t,n)=>{n.d(t,{Jt:()=>l,TF:()=>r,bE:()=>i,yJ:()=>a});var o=n(32026),s=n(44364);async function l(e,t){return c("GET",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function i(e,t){return c("POST",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function a(e,t){return c("PUT",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function r(e,t){return c("DELETE",e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}async function c(e,t,n){let{headers:o,noAuth:s,...l}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i="POST"===e||"PUT"===e||"DELETE"===e;t=function(e,t){if(!e)return e;const n=t&&Object.keys(t);if(null!==n&&void 0!==n&&n.length){const o=n.reduce(((e,n)=>{let o=t[n];return null===o||void 0===o?e:(o=`${n}=${encodeURIComponent(o)}`,e?`${e}&${o}`:o)}),"");o&&(e=`${e}${e.includes("?")?"&":"?"}${o}`)}if(e.startsWith("https://"))return e;return`${d}${e}`}(t,i?void 0:n);const a=n instanceof FormData;if(a||(n=n&&"object"===typeof n&&i?JSON.stringify(n):void 0),o||(o={}),a||(o["Content-Type"]="application/json"),o.Accept="application/json",!1!==s){const e=sessionStorage.getItem("token");e&&(o.Authorization=`Bearer ${e}`)}try{const s=await fetch(t,{...l,headers:o,body:n,method:e}),i=await s.json();if(s.ok){const{data:e,...t}=i;return delete t.status,e&&!Object.keys(t).length?e:i}throw i.message?new Error(i.message):i}catch(c){var r;throw console.error("Error calling API: ",c),null!==(r=c.message)&&void 0!==r&&r.includes("fetch")?new Error("Unable to reach server. Please check your network connectivity and try again."):new Error(c.message)}}const d=(0,o.s8)(s.jn,"/")},28564:(e,t,n)=>{n.d(t,{C7:()=>r,CC:()=>d,EO:()=>l,EZ:()=>a,Ek:()=>c,Gl:()=>i});var o=n(33340),s=n(8478);async function l(e){const{selectedBotId:t,organizationId:n}=o.nc.getState();return await i(n,t,e)}async function i(e,t,n){return await s.Jt(`/bot/${e}/${t}/chat-flow/${n}`)}async function a(e,t,n){const o=`/bot/${e}/${t}/chat-flow${arguments.length>3&&void 0!==arguments[3]&&arguments[3]?"?deploy=true":""}`;return await s.bE(o,n)}async function r(e,t,n){return await s.TF(`/bot/${e}/${t}/chat-flow/${n}`)}async function c(){const{selectedBotId:e,organizationId:t}=o.nc.getState();return(await s.Jt(`/bot/${t}/${e}/chat-flow`)).map(d)}function d(e){return{value:e._id,label:`v${e.version} - ${e.deployedAt?"Deployed":"Draft"}`}}},32026:(e,t,n)=>{function o(e,t){return e.replace(new RegExp(`${s(t)}+$`),"")}function s(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l(e){const t=new Date(e),n=t.getDate();return`${["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]} ${n}, ${t.getFullYear()}`}function i(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const s=t.indexOf("."),l=t.substring(0,s),a=t.substring(s+1);o[l]=i(e[l],a,n)}else o[t]=n;return o}function a(e,t){return btoa(`${e}_${t}_whatsapp_int`)}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t="abcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let o=0;o<e;o++)n+=t.charAt(Math.floor(36*Math.random()));return n}function c(e,t,n){if(!t&&!e)return n;e=e||{};const o=Array.isArray(e)?[...e]:{...e};if(t.includes(".")){const s=t.indexOf("."),l=t.substring(0,s),i=t.substring(s+1);o[l]=c(e[l],i,n)}else o[t]=n;return o}function d(e,t){const n=new Blob([e],{type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/csv"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o)}n.d(t,{G6:()=>i,OX:()=>r,PE:()=>d,Yq:()=>l,do:()=>c,qW:()=>a,s8:()=>o})},44364:(e,t,n)=>{n.d(t,{DX:()=>r,Og:()=>l,jn:()=>o,mB:()=>a,pA:()=>i,pR:()=>s});const o="https://devbackend.livhousing.com:444",s="c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",l={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.TRAINING_MEDIA_MAXSIZE,i={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.CONVERSATION_MEDIA_MAXSIZE,a={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.GOOGLE_MAPS_API_KEY,r={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_IP_DATA_API_KEY:"c17b949cf58c45cae47ce1cc65efc8240f77a2a69ca09ad4c4208852",REACT_APP_VERSION:"1",REACT_APP_BACKEND_URL:"https://devbackend.livhousing.com:444"}.REACT_APP_NGROK_BACKEND_URL||"https://devbackend.livhousing.com:444"}}]);